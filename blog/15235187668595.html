<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰ - AlienZHOU's blog
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="AlienZHOU's blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">AlienZHOU's blog</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; AlienZHOU's blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>PWA</label></li>

          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜" href="15235166926023.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨" href="15235151669706.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€" href="15235140795593.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…" href="15235138633619.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…</a></li>
          

      
        <li class="divider"></li>
        <li><label>React</label></li>

          
            <li><a title="åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ" href="15236392559880.html">åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</a></li>
          
            <li><a title="åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰" href="15235187668595.html">åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</a></li>
          

      
        <li class="divider"></li>
        <li><label>CSS</label></li>

          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘" href="15236398426783.html">ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘</a></li>
          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS" href="15236396803035.html">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS</a></li>
          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope" href="15236395841604.html">ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a></li>
          

      
        <li class="divider"></li>
        <li><label>Server</label></li>

          
            <li><a title="ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹" href="15236400113573.html">ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a></li>
          

      
        <li class="divider"></li>
        <li><label>Automation</label></li>

          
            <li><a title="Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—" href="15236401468681.html">Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</a></li>
          

      
        <li class="divider"></li>
        <li><label>FE else</label></li>

          
            <li><a title="æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»" href="15236404711802.html">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a></li>
          
            <li><a title="JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ" href="15236403350295.html">JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</a></li>
          
            <li><a title="jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰" href="15236405992551.html">jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>PWA</span></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜" href="15235166926023.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨" href="15235151669706.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€" href="15235140795593.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…" href="15235138633619.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…</a></li>
                        

                    
                      <li class="side-title"><span>React</span></li>
                        
                          <li><a title="åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ" href="15236392559880.html">åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</a></li>
                        
                          <li><a title="åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰" href="15235187668595.html">åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</a></li>
                        

                    
                      <li class="side-title"><span>CSS</span></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘" href="15236398426783.html">ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘</a></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS" href="15236396803035.html">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS</a></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope" href="15236395841604.html">ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a></li>
                        

                    
                      <li class="side-title"><span>Server</span></li>
                        
                          <li><a title="ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹" href="15236400113573.html">ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a></li>
                        

                    
                      <li class="side-title"><span>Automation</span></li>
                        
                          <li><a title="Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—" href="15236401468681.html">Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</a></li>
                        

                    
                      <li class="side-title"><span>FE else</span></li>
                        
                          <li><a title="æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»" href="15236404711802.html">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a></li>
                        
                          <li><a title="JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ" href="15236403350295.html">JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</a></li>
                        
                          <li><a title="jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰" href="15236405992551.html">jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</h1>

<h2 id="toc_0">å‰è¨€</h2>

<p>éšç€å‰ç«¯é¡¹ç›®çš„ä¸æ–­æ‰©å¤§ï¼Œä¸€ä¸ªåŸæœ¬ç®€å•çš„ç½‘é¡µåº”ç”¨æ‰€å¼•ç”¨çš„jsæ–‡ä»¶å¯èƒ½å˜å¾—è¶Šæ¥è¶Šåºå¤§ã€‚å°¤å…¶åœ¨è¿‘æœŸæµè¡Œçš„å•é¡µé¢åº”ç”¨ä¸­ï¼Œè¶Šæ¥è¶Šä¾èµ–ä¸€äº›æ‰“åŒ…å·¥å…·ï¼ˆä¾‹å¦‚webpackï¼‰ï¼Œé€šè¿‡è¿™äº›æ‰“åŒ…å·¥å…·å°†éœ€è¦å¤„ç†ã€ç›¸äº’ä¾èµ–çš„æ¨¡å—ç›´æ¥æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„bundleæ–‡ä»¶ï¼Œåœ¨é¡µé¢ç¬¬ä¸€æ¬¡è½½å…¥æ—¶ï¼Œå°±ä¼šå°†æ‰€æœ‰çš„jså…¨éƒ¨è½½å…¥ã€‚ä½†æ˜¯ï¼Œå¾€å¾€æœ‰è®¸å¤šçš„åœºæ™¯ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨ä¸€æ¬¡æ€§å°†å•é¡µåº”ç”¨çš„å…¨éƒ¨ä¾èµ–éƒ½è½½ä¸‹æ¥ã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå¸¦æœ‰æƒé™çš„&quot;è®¢å•åå°ç®¡ç†&quot;å•é¡µåº”ç”¨ï¼Œæ™®é€šç®¡ç†å‘˜åªèƒ½è¿›å…¥&quot;è®¢å•ç®¡ç†&quot;éƒ¨åˆ†ï¼Œè€Œè¶…çº§ç”¨æˆ·åˆ™å¯ä»¥è¿›è¡Œ&quot;ç³»ç»Ÿç®¡ç†&quot;ï¼›æˆ–è€…ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåºå¤§çš„å•é¡µåº”ç”¨ï¼Œç”¨æˆ·åœ¨ç¬¬ä¸€æ¬¡æ‰“å¼€é¡µé¢æ—¶ï¼Œéœ€è¦ç­‰å¾…è¾ƒé•¿æ—¶é—´åŠ è½½æ— å…³èµ„æºã€‚è¿™äº›æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘è¿›è¡Œä¸€å®šçš„ä»£ç æ‹†åˆ†ï¼ˆ<em>code splitting</em>ï¼‰ã€‚</p>

<h2 id="toc_1">å®ç°æ–¹å¼</h2>

<h3 id="toc_2">ç®€å•çš„æŒ‰éœ€åŠ è½½</h3>

<p>ä»£ç æ‹†åˆ†çš„æ ¸å¿ƒç›®çš„ï¼Œå°±æ˜¯å®ç°èµ„æºçš„æŒ‰éœ€åŠ è½½ã€‚è€ƒè™‘è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œåœ¨æˆ‘ä»¬çš„ç½‘ç«™ä¸­ï¼Œå³ä¸‹è§’æœ‰ä¸€ä¸ªç±»ä¼¼èŠå¤©æ¡†çš„ç»„ä»¶ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»åœ†å½¢æŒ‰é’®æ—¶ï¼Œé¡µé¢å±•ç¤ºèŠå¤©ç»„ä»¶ã€‚ </p>

<pre><code>btn.addEventListener(&#39;click&#39;, function(e) {
    // åœ¨è¿™é‡ŒåŠ è½½chatç»„ä»¶ç›¸å…³èµ„æº chat.js
});
</code></pre>

<p>ä»è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡å°†åŠ è½½chat.jsçš„æ“ä½œç»‘å®šåœ¨btnç‚¹å‡»äº‹ä»¶ä¸Šï¼Œå¯ä»¥å®ç°ç‚¹å‡»èŠå¤©æŒ‰é’®åèŠå¤©ç»„ä»¶çš„æŒ‰éœ€åŠ è½½ã€‚è€Œè¦åŠ¨æ€åŠ è½½jsèµ„æºçš„æ–¹å¼ä¹Ÿéå¸¸ç®€å•ï¼ˆæ–¹å¼ç±»ä¼¼ç†Ÿæ‚‰çš„jsonpï¼‰ã€‚é€šè¿‡åŠ¨æ€åœ¨é¡µé¢ä¸­æ·»åŠ <code>&lt;scrpt&gt;</code>æ ‡ç­¾ï¼Œå¹¶å°†<code>src</code>å±æ€§æŒ‡å‘è¯¥èµ„æºå³å¯ã€‚</p>

<pre><code>btn.addEventListener(&#39;click&#39;, function(e) {
    // åœ¨è¿™é‡ŒåŠ è½½chatç»„ä»¶ç›¸å…³èµ„æº chat.js
    var ele = document.createElement(&#39;script&#39;);
    ele.setAttribute(&#39;src&#39;,&#39;/static/chat.js&#39;);
    document.getElementsByTagName(&#39;head&#39;)[0].appendChild(ele);
});
</code></pre>

<p>ä»£ç æ‹†åˆ†å°±æ˜¯ä¸ºäº†è¦å®ç°æŒ‰éœ€åŠ è½½æ‰€åšçš„å·¥ä½œã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‰“åŒ…å·¥å…·ï¼Œå°†æ‰€æœ‰çš„jså…¨éƒ¨æ‰“åŒ…åˆ°äº†bundle.jsè¿™ä¸ªæ–‡ä»¶ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯æ²¡æœ‰åŠæ³•åšåˆ°ä¸Šé¢æ‰€è¿°çš„æŒ‰éœ€åŠ è½½çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®²æŒ‰éœ€åŠ è½½çš„ä»£ç åœ¨æ‰“åŒ…çš„è¿‡ç¨‹ä¸­æ‹†åˆ†å‡ºæ¥ï¼Œè¿™å°±æ˜¯ä»£ç æ‹†åˆ†ã€‚é‚£ä¹ˆï¼Œå¯¹äºè¿™äº›èµ„æºï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ‹†åˆ†ä¹ˆï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œè¿˜æ˜¯è¦å€ŸåŠ©æ‰“åŒ…å·¥å…·ã€‚ä¸‹é¢å°±æ¥ä»‹ç»webpackä¸­çš„ä»£ç æ‹†åˆ†ã€‚</p>

<h3 id="toc_3">ä»£ç æ‹†åˆ†</h3>

<p>è¿™é‡Œå›åˆ°åº”ç”¨åœºæ™¯ï¼Œä»‹ç»å¦‚ä½•åœ¨webpackä¸­è¿›è¡Œä»£ç æ‹†åˆ†ã€‚åœ¨webpackæœ‰å¤šç§æ–¹å¼æ¥å®ç°æ„å»ºæ˜¯çš„ä»£ç æ‹†åˆ†ã€‚</p>

<h4 id="toc_4">1. import()</h4>

<p>è¿™é‡Œçš„importä¸åŒäºæ¨¡å—å¼•å…¥æ—¶çš„importï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŠ¨æ€åŠ è½½çš„æ¨¡å—çš„å‡½æ•°(<em>function-like</em>)ï¼Œä¼ å…¥å…¶ä¸­çš„å‚æ•°å°±æ˜¯ç›¸åº”çš„æ¨¡å—ã€‚ä¾‹å¦‚å¯¹äºåŸæœ‰çš„æ¨¡å—å¼•å…¥<code>import react from &#39;react&#39;</code>å¯ä»¥å†™ä¸º<code>import(&#39;react&#39;)</code>ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>import()</code>ä¼šè¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ä½¿ç”¨ï¼š</p>

<pre><code>btn.addEventListener(&#39;click&#39;, e =&gt; {
    // åœ¨è¿™é‡ŒåŠ è½½chatç»„ä»¶ç›¸å…³èµ„æº chat.js
    import(&#39;/components/chart&#39;).then(mod =&gt; {
        someOperate(mod);
    });
});
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼Œå’Œå¹³æ—¶æˆ‘ä»¬ä½¿ç”¨çš„<code>Promise</code>å¹¶æ²¡æœ‰åŒºåˆ«ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å†åŠ å…¥ä¸€äº›å¼‚å¸¸å¤„ç†ï¼š</p>

<pre><code>btn.addEventListener(&#39;click&#39;, e =&gt; {
    import(&#39;/components/chart&#39;).then(mod =&gt; {
        someOperate(mod);
    }).catch(err ï¼&gt; {
        console.log(&#39;failed&#39;);
    });
});
</code></pre>

<p>å½“ç„¶ï¼Œç”±äº<code>import()</code>ä¼šè¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ï¼Œå› æ­¤è¦æ³¨æ„ä¸€äº›å…¼å®¹æ€§é—®é¢˜ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸å›°éš¾ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›<code>Promise</code>çš„polyfillæ¥å®ç°å…¼å®¹ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒåŠ¨æ€<code>import()</code>çš„æ–¹å¼ä¸è®ºåœ¨è¯­æ„ä¸Šè¿˜æ˜¯è¯­æ³•ä½¿ç”¨ä¸Šéƒ½æ˜¯æ¯”è¾ƒæ¸…æ™°ç®€æ´çš„ã€‚</p>

<h4 id="toc_5">2. require.ensure()</h4>

<p>åœ¨webpack 2çš„å®˜ç½‘ä¸Šå†™äº†è¿™ä¹ˆä¸€å¥è¯ï¼š</p>

<blockquote>
<p><em>require.ensure()</em> is specific to webpack and superseded by <em>import()</em>.</p>
</blockquote>

<p>æ‰€ä»¥ï¼Œåœ¨webpack 2é‡Œé¢åº”è¯¥æ˜¯ä¸å»ºè®®ä½¿ç”¨<code>require.ensure()</code>è¿™ä¸ªæ–¹æ³•çš„ã€‚ä½†æ˜¯ç›®å‰è¯¥æ–¹æ³•ä»ç„¶æœ‰æ•ˆï¼Œæ‰€ä»¥å¯ä»¥ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚åŒ…æ‹¬åœ¨webpack 1ä¸­ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯<code>require.ensure()</code>çš„è¯­æ³•ï¼š</p>

<pre><code>require.ensure(dependencies: String[], callback: function(require), errorCallback: function(error), chunkName: String)
</code></pre>

<p><code>require.ensure()</code>æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š</p>

<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°<code>dependencies</code>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä»£è¡¨äº†å½“å‰<code>require</code>è¿›æ¥çš„æ¨¡å—çš„ä¸€äº›ä¾èµ–ï¼›</li>
<li>ç¬¬äºŒä¸ªå‚æ•°<code>callback</code>å°±æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°<code>require</code>ï¼Œé€šè¿‡è¿™ä¸ª<code>require</code>å°±å¯ä»¥åœ¨å›è°ƒå‡½æ•°å†…åŠ¨æ€å¼•å…¥å…¶ä»–æ¨¡å—ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶è¿™ä¸ª<code>require</code>æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œç†è®ºä¸Šå¯ä»¥æ¢å…¶ä»–åç§°ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸èƒ½æ¢çš„ï¼Œå¦åˆ™webpackå°±æ— æ³•é™æ€åˆ†æçš„æ—¶å€™å¤„ç†å®ƒï¼›</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°<code>errorCallback</code>æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯å¤„ç†errorçš„å›è°ƒï¼›</li>
<li>ç¬¬å››ä¸ªå‚æ•°<code>chunkName</code>åˆ™æ˜¯æŒ‡å®šæ‰“åŒ…çš„chunkåç§°ã€‚</li>
</ul>

<p>å› æ­¤ï¼Œ<code>require.ensure()</code>å…·ä½“çš„ç”¨æ³•å¦‚ä¸‹ï¼š</p>

<pre><code>btn.addEventListener(&#39;click&#39;, e =&gt; {
    require.ensure([], require =&gt; {
        let chat = require(&#39;/components/chart&#39;);
        someOperate(chat);
    }, error =&gt; {
        console.log(&#39;failed&#39;);
    }, &#39;mychat&#39;);
});
</code></pre>

<h4 id="toc_6">3. Bundle Loader</h4>

<p>é™¤äº†ä½¿ç”¨ä¸Šè¿°ä¸¤ç§æ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨webpackçš„ä¸€äº›ç»„ä»¶ã€‚ä¾‹å¦‚ä½¿ç”¨<a href="https://github.com/webpack-contrib/bundle-loader">Bundle Loader</a>ï¼š</p>

<pre><code>npm i --save bundle-loader
</code></pre>

<p>ä½¿ç”¨<code>require(&quot;bundle-loader!./file.js&quot;)</code>æ¥è¿›è¡Œç›¸åº”chunkçš„åŠ è½½ã€‚è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>function</code>ï¼Œè¿™ä¸ª<code>function</code>æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚</p>

<pre><code>let chatChunk = require(&quot;bundle-loader?lazy!./components/chat&quot;);
chatChunk(function(file) {
    someOperate(file);
});
</code></pre>

<p>å’Œå…¶ä»–loaderç±»ä¼¼ï¼ŒBundle Loaderä¹Ÿéœ€è¦åœ¨webpackçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç›¸åº”é…ç½®ã€‚Bundle-Loaderçš„<a href="https://github.com/webpack-contrib/bundle-loader/blob/master/index.js">ä»£ç </a>ä¹Ÿå¾ˆç®€çŸ­ï¼Œå¦‚æœé˜…è¯»ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œå…¶å®é™…ä¸Šä¹Ÿæ˜¯ä½¿ç”¨<code>require.ensure()</code>æ¥å®ç°çš„ï¼Œé€šè¿‡ç»™Bundle-Loaderè¿”å›çš„å‡½æ•°ä¸­ä¼ å…¥ç›¸åº”çš„æ¨¡å—å¤„ç†å›è°ƒå‡½æ•°å³å¯åœ¨<code>require.ensure()</code>çš„ä¸­å¤„ç†ï¼Œä»£ç æœ€åä¹Ÿåˆ—å‡ºäº†ç›¸åº”çš„è¾“å‡ºæ ¼å¼ï¼š</p>

<pre><code>/*
Output format:
    var cbs = [],
        data;
    module.exports = function(cb) {
        if(cbs) cbs.push(cb);
            else cb(data);
    }
    require.ensure([], function(require) {
        data = require(&quot;xxx&quot;);
        var callbacks = cbs;
        cbs = null;
        for(var i = 0, l = callbacks.length; i &lt; l; i++) {
            callbacks[i](data);
        }
    });
*/
</code></pre>

<h2 id="toc_7">react-router v4 ä¸­çš„ä»£ç æ‹†åˆ†</h2>

<p>æœ€åï¼Œå›åˆ°å®é™…çš„å·¥ä½œä¸­ï¼ŒåŸºäºwebpackï¼Œåœ¨react-router4ä¸­å®ç°ä»£ç æ‹†åˆ†ã€‚react-router 4ç›¸è¾ƒäºreact-router 3æœ‰äº†è¾ƒå¤§çš„å˜åŠ¨ã€‚å…¶ä¸­ï¼Œåœ¨ä»£ç æ‹†åˆ†æ–¹é¢ï¼Œreact-router 4çš„ä½¿ç”¨æ–¹å¼ä¹Ÿä¸react-router 3æœ‰äº†è¾ƒå¤§çš„å·®åˆ«ã€‚<br/>
åœ¨react-router 3ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>Route</code>ç»„ä»¶ä¸­<code>getComponent</code>è¿™ä¸ªAPIæ¥è¿›è¡Œä»£ç æ‹†åˆ†ã€‚<code>getComponent</code>æ˜¯å¼‚æ­¥çš„ï¼Œåªæœ‰åœ¨è·¯ç”±åŒ¹é…æ—¶æ‰ä¼šè°ƒç”¨ã€‚ä½†æ˜¯ï¼Œåœ¨<code>react-router 4</code>ä¸­å¹¶æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªAPIï¼Œé‚£ä¹ˆå¦‚ä½•æ¥è¿›è¡Œä»£ç æ‹†åˆ†å‘¢ï¼Ÿ<br/>
åœ¨<a href="https://reacttraining.com/react-router/web/guides/code-splitting">react-router 4</a>å®˜ç½‘ä¸Šæœ‰ä¸€ä¸ªä»£ç æ‹†åˆ†çš„ä¾‹å­ã€‚å…¶ä¸­ï¼Œåº”ç”¨äº†Bundle Loaderæ¥è¿›è¡ŒæŒ‰éœ€åŠ è½½ä¸åŠ¨æ€å¼•å…¥</p>

<pre><code>import loadSomething from &#39;bundle-loader?lazy!./Something&#39;
</code></pre>

<p>ç„¶è€Œï¼Œåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç±»ä¼¼çš„æ–¹å¼åï¼Œå‡ºç°äº†è¿™æ ·çš„è­¦å‘Šï¼š</p>

<blockquote>
<p>Unexpected &#39;!&#39; in &#39;bundle-loader?lazy!./component/chat&#39;. Do not use import syntax to configure webpack loaders  <strong><em>import/no-webpack-loader-syntax</em></strong><br/>
Search for the <strong><em>keywords</em></strong> to learn more about each error.</p>
</blockquote>

<p>åœ¨webpack 2ä¸­å·²ç»ä¸èƒ½ä½¿ç”¨importè¿™æ ·çš„æ–¹å¼æ¥å¼•å…¥loaderäº†ï¼ˆ<a href="https://github.com/benmosher/eslint-plugin-import/blob/master/docs/rules/no-webpack-loader-syntax.md">no-webpack-loader-syntax</a>ï¼‰</p>

<blockquote>
<p>Webpack allows specifying the loaders to use in the import source string using a special syntax like this:</p>
</blockquote>

<pre><code>var moduleWithOneLoader = require(&quot;my-loader!./my-awesome-module&quot;);
</code></pre>

<blockquote>
<p>This syntax is non-standard, so it couples the code to Webpack. The recommended way to specify Webpack loader configuration is in a <strong>Webpack configuration file</strong>.</p>
</blockquote>

<p>æˆ‘çš„åº”ç”¨ä½¿ç”¨äº†create-react-appä½œä¸ºè„šæ‰‹æ¶ï¼Œå±è”½äº†webpackçš„ä¸€äº›é…ç½®ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿è¡Œ<code>npm run eject</code>ä½¿å…¶æš´éœ²webpackç­‰é…ç½®æ–‡ä»¶ã€‚ç„¶è€Œï¼Œæ˜¯å¦å¯ä»¥ç”¨å…¶ä»–æ–¹æ³•å‘¢ï¼Ÿå½“ç„¶ã€‚<br/>
è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨ä¹‹å‰è¯´åˆ°çš„ä¸¤ç§æ–¹å¼æ¥å¤„ç†ï¼š<code>import()</code>æˆ–<code>require.ensure()</code>ã€‚<br/>
å’Œå®˜æ–¹å®ä¾‹ç±»ä¼¼ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªå¼‚æ­¥åŠ è½½çš„åŒ…è£…ç»„ä»¶Bundleã€‚Bundleçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯æ¥æ”¶ä¸€ä¸ªç»„ä»¶å¼‚æ­¥åŠ è½½çš„æ–¹æ³•ï¼Œå¹¶è¿”å›ç›¸åº”çš„reactç»„ä»¶ï¼š</p>

<pre><code>export default class Bundle extends Component {
    constructor(props) {
        super(props);
        this.state = {
            mod: null
        };
    }

    componentWillMount() {
        this.load(this.props)
    }

    componentWillReceiveProps(nextProps) {
        if (nextProps.load !== this.props.load) {
            this.load(nextProps)
        }
    }

    load(props) {
        this.setState({
            mod: null
        });
        props.load((mod) =&gt; {
            this.setState({
                mod: mod.default ? mod.default : mod
            });
        });
    }

    render() {
        return this.state.mod ? this.props.children(this.state.mod) : null;
    }
}
</code></pre>

<p>åœ¨åŸæœ‰çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡Bundle Loaderæ¥å¼•å…¥æ¨¡å—ï¼š</p>

<pre><code>import loadSomething from &#39;bundle-loader?lazy!./About&#39;

const About = (props) =&gt; (
    &lt;Bundle load={loadAbout}&gt;
        {(About) =&gt; &lt;About {...props}/&gt;}
    &lt;/Bundle&gt;
)
</code></pre>

<p>ç”±äºä¸å†ä½¿ç”¨Bundle Loaderï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>import()</code>å¯¹è¯¥æ®µä»£ç è¿›è¡Œæ”¹å†™ï¼š</p>

<pre><code>const Chat = (props) =&gt; (
    &lt;Bundle load={() =&gt; import(&#39;./component/chat&#39;)}&gt;
        {(Chat) =&gt; &lt;Chat {...props}/&gt;}
    &lt;/Bundle&gt;
);
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº<code>import()</code>ä¼šè¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ï¼Œå› æ­¤<code>Bundle</code>ç»„ä»¶ä¸­çš„ä»£ç ä¹Ÿéœ€è¦ç›¸åº”è¿›è¡Œè°ƒæ•´</p>

<pre><code>export default class Bundle extends Component {
    constructor(props) {
        super(props);
        this.state = {
            mod: null
        };
    }

    componentWillMount() {
        this.load(this.props)
    }

    componentWillReceiveProps(nextProps) {
        if (nextProps.load !== this.props.load) {
            this.load(nextProps)
        }
    }

    load(props) {
        this.setState({
            mod: null
        });
        //æ³¨æ„è¿™é‡Œï¼Œä½¿ç”¨Promiseå¯¹è±¡; mod.defaultå¯¼å‡ºé»˜è®¤
        props.load().then((mod) =&gt; {
            this.setState({
                mod: mod.default ? mod.default : mod
            });
        });
    }

    render() {
        return this.state.mod ? this.props.children(this.state.mod) : null;
    }
}
</code></pre>

<p>è·¯ç”±éƒ¨åˆ†æ²¡æœ‰å˜åŒ–</p>

<pre><code>&lt;Route path=&quot;/chat&quot; component={Chat}/&gt;
</code></pre>

<p>è¿™æ—¶å€™ï¼Œæ‰§è¡Œ<code>npm run start</code>ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è½½å…¥æœ€åˆçš„é¡µé¢æ—¶åŠ è½½çš„èµ„æºå¦‚ä¸‹</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-c7d1c77bcbade8ee?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"/></p>

<p>è€Œå½“ç‚¹å‡»è§¦å‘åˆ°/chatè·¯å¾„æ—¶ï¼Œå¯ä»¥çœ‹åˆ°</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-edac2f3e0b68de1b?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"/></p>

<p>åŠ¨æ€åŠ è½½äº†<code>2.chunk.js</code>è¿™ä¸ªjsæ–‡ä»¶ï¼Œå¦‚æœæ‰“å¼€è¿™ä¸ªæ–‡ä»¶æŸ¥çœ‹ï¼Œå°±å¯ä»¥å‘ç°è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬åˆšæ‰åŠ¨æ€<code>import()</code>è¿›æ¥çš„æ¨¡å—ã€‚<br/>
å½“ç„¶ï¼Œé™¤äº†ä½¿ç”¨<code>import()</code>ä»ç„¶å¯ä»¥ä½¿ç”¨<code>require.ensure()</code>æ¥è¿›è¡Œæ¨¡å—çš„å¼‚æ­¥åŠ è½½ã€‚ç›¸å…³ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>const Chat = (props) =&gt; (
    &lt;Bundle load={(cb) =&gt; {
        require.ensure([], require =&gt; {
            cb(require(&#39;./component/chat&#39;));
        });
    }}&gt;
    {(Chat) =&gt; &lt;Chat {...props}/&gt;}
  &lt;/Bundle&gt;
);
</code></pre>

<pre><code>export default class Bundle extends Component {
    constructor(props) {
        super(props);
        this.state = {
            mod: null
        };
    }

    load = props =&gt; {
        this.setState({
            mod: null
        });
        props.load(mod =&gt; {
            this.setState({
                mod: mod ? mod : null
            });
        });
    }

    componentWillMount() {
        this.load(this.props);
    }

    render() {
        return this.state.mod ? this.props.children(this.state.mod) : null
    }
}
</code></pre>

<p>æ­¤å¤–ï¼Œå¦‚æœæ˜¯ç›´æ¥ä½¿ç”¨webpack configçš„è¯ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®</p>

<pre><code>output: {
    // The build folder.
    path: paths.appBuild,
    // There will be one main bundle, and one file per asynchronous chunk.
    filename: &#39;static/js/[name].[chunkhash:8].js&#39;,
    chunkFilename: &#39;static/js/[name].[chunkhash:8].chunk.js&#39;,
  },
</code></pre>

<h2 id="toc_8">ç»“æŸ</h2>

<p>ä»£ç æ‹†åˆ†åœ¨å•é¡µåº”ç”¨ä¸­éå¸¸å¸¸è§ï¼Œå¯¹äºæé«˜å•é¡µåº”ç”¨çš„æ€§èƒ½ä¸ä½“éªŒå…·æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚æˆ‘ä»¬é€šè¿‡å°†ç¬¬ä¸€æ¬¡è®¿é—®åº”ç”¨æ—¶ï¼Œå¹¶ä¸éœ€è¦çš„æ¨¡å—æ‹†åˆ†å‡ºæ¥ï¼Œé€šè¿‡<code>scipt</code>æ ‡ç­¾åŠ¨æ€åŠ è½½çš„åŸç†ï¼Œå¯ä»¥å®ç°æœ‰æ•ˆçš„ä»£ç æ‹†åˆ†ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½¿ç”¨webpackä¸­çš„<code>import()</code>ã€<code>require.ensure()</code>æˆ–è€…ä¸€äº›<code>loader</code>ï¼ˆä¾‹å¦‚Bundle Loaderï¼‰æ¥åšä»£ç æ‹†åˆ†ä¸ç»„ä»¶æŒ‰éœ€åŠ è½½ã€‚</p>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15236395841604.html"  title="Previous Post: ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope">&laquo; ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15235187668595.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
