<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ - AlienZHOU's blog
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="AlienZHOU's blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">AlienZHOU's blog</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; AlienZHOU's blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>PWA</label></li>

          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜" href="15235166926023.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨" href="15235151669706.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…" href="15235138633619.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€" href="15235140795593.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€</a></li>
          

      
        <li class="divider"></li>
        <li><label>React</label></li>

          
            <li><a title="åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ" href="15236392559880.html">åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</a></li>
          
            <li><a title="åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰" href="15235187668595.html">åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</a></li>
          

      
        <li class="divider"></li>
        <li><label>CSS</label></li>

          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘" href="15236398426783.html">ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘</a></li>
          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS" href="15236396803035.html">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS</a></li>
          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope" href="15236395841604.html">ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a></li>
          

      
        <li class="divider"></li>
        <li><label>Server</label></li>

          
            <li><a title="ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹" href="15236400113573.html">ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a></li>
          

      
        <li class="divider"></li>
        <li><label>Automation</label></li>

          
            <li><a title="Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—" href="15236401468681.html">Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</a></li>
          

      
        <li class="divider"></li>
        <li><label>FE else</label></li>

          
            <li><a title="æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»" href="15236404711802.html">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a></li>
          
            <li><a title="JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ" href="15236403350295.html">JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</a></li>
          
            <li><a title="jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰" href="15236405992551.html">jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>PWA</span></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜" href="15235166926023.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨" href="15235151669706.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…" href="15235138633619.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€" href="15235140795593.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€</a></li>
                        

                    
                      <li class="side-title"><span>React</span></li>
                        
                          <li><a title="åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ" href="15236392559880.html">åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</a></li>
                        
                          <li><a title="åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰" href="15235187668595.html">åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</a></li>
                        

                    
                      <li class="side-title"><span>CSS</span></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘" href="15236398426783.html">ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘</a></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS" href="15236396803035.html">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS</a></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope" href="15236395841604.html">ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a></li>
                        

                    
                      <li class="side-title"><span>Server</span></li>
                        
                          <li><a title="ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹" href="15236400113573.html">ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a></li>
                        

                    
                      <li class="side-title"><span>Automation</span></li>
                        
                          <li><a title="Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—" href="15236401468681.html">Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</a></li>
                        

                    
                      <li class="side-title"><span>FE else</span></li>
                        
                          <li><a title="æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»" href="15236404711802.html">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a></li>
                        
                          <li><a title="JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ" href="15236403350295.html">JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</a></li>
                        
                          <li><a title="jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰" href="15236405992551.html">jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</h1>

<blockquote>
<p>å¼‚æ­¥ç¼–ç¨‹åœ¨JavaScriptä¸­éå¸¸é‡è¦ã€‚è¿‡å¤šçš„å¼‚æ­¥ç¼–ç¨‹ä¹Ÿå¸¦äº†å›è°ƒåµŒå¥—çš„é—®é¢˜ï¼Œæœ¬æ–‡ä¼šæä¾›ä¸€äº›è§£å†³â€œå›è°ƒåœ°ç‹±â€çš„æ–¹æ³•ã€‚</p>
</blockquote>

<pre><code class="language-javascript">setTimeout(function () {
    console.log(&#39;å»¶æ—¶è§¦å‘&#39;);
}, 2000);

fs.readFile(&#39;./sample.txt&#39;, &#39;utf-8&#39;, function (err, res) {
    console.log(res);
});
</code></pre>

<p>ä¸Šé¢å°±æ˜¯å…¸å‹çš„å›è°ƒå‡½æ•°ï¼Œä¸è®ºæ˜¯åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿˜æ˜¯åœ¨nodeä¸­ï¼ŒJavaScriptæœ¬èº«æ˜¯å•çº¿ç¨‹ï¼Œå› æ­¤ï¼Œä¸ºäº†åº”å¯¹ä¸€äº›å•çº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ï¼Œå¼‚æ­¥ç¼–ç¨‹æˆä¸ºäº†JavaScriptä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚</p>

<p>ä¸è®ºæ˜¯æµè§ˆå™¨ä¸­æœ€ä¸ºå¸¸è§çš„ajaxã€äº‹ä»¶ç›‘å¬ï¼Œè¿˜æ˜¯nodeä¸­æ–‡ä»¶è¯»å–ã€ç½‘ç»œç¼–ç¨‹ã€æ•°æ®åº“ç­‰æ“ä½œï¼Œéƒ½ç¦»ä¸å¼€å¼‚æ­¥ç¼–ç¨‹ã€‚åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œè®¸å¤šæ“ä½œéƒ½ä¼šæ”¾åœ¨å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ä¸­ã€‚åŒæ­¥ä¸å¼‚æ­¥çš„æ··æ‚ã€è¿‡å¤šçš„å›è°ƒåµŒå¥—éƒ½ä¼šä½¿å¾—ä»£ç å˜å¾—éš¾ä»¥ç†è§£ä¸ç»´æŠ¤ï¼Œè¿™ä¹Ÿæ˜¯å¸¸å—äººè¯Ÿç—…çš„åœ°æ–¹ã€‚</p>

<p>å…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç </p>

<pre><code class="language-javascript">fs.readFile(&#39;./sample.txt&#39;, &#39;utf-8&#39;, (err, content) =&gt; {
    let keyword = content.substring(0, 5);
    db.find(`select * from sample where kw = ${keyword}`, (err, res) =&gt; {
        get(`/sampleget?count=${res.length}`, data =&gt; {
           console.log(data);
        });
    });
});
</code></pre>

<p>é¦–å…ˆæˆ‘ä»¬è¯»å–çš„ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å…³é”®å­—<code>keyword</code>ï¼Œç„¶åæ ¹æ®è¯¥<code>keyword</code>è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œæœ€åä¾æ®æŸ¥è¯¢ç»“æœè¯·æ±‚æ•°æ®ã€‚</p>

<p>å…¶ä¸­åŒ…å«äº†ä¸‰ä¸ªå¼‚æ­¥æ“ä½œï¼š</p>

<ul>
<li>æ–‡ä»¶è¯»å–ï¼šfs.readFile</li>
<li>æ•°æ®åº“æŸ¥è¯¢ï¼šdb.find</li>
<li>httpè¯·æ±‚ï¼šget</li>
</ul>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ²¡å¢åŠ ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå°±ä¼šå¤šæ·»åŠ ä¸€å±‚å›è°ƒå‡½æ•°çš„åµŒå¥—ï¼Œè¿™æ®µä»£ç ä¸­ä¸‰ä¸ªå¼‚æ­¥å‡½æ•°çš„åµŒå¥—å·²ç»å¼€å§‹ä½¿ä¸€æ®µæœ¬å¯ä»¥è¯­è¨€æ˜ç¡®çš„ä»£ç ç¼–ç¨‹ä¸æ˜“é˜…è¯»ä¸ç»´æŠ¤äº†ã€‚</p>

<p>æŠ½è±¡å‡ºæ¥è¿™ç§ä»£ç ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p>

<pre><code class="language-javascript">asyncFunc1(opt, (...args1) =&gt; {
    asyncFunc2(opt, (...args2) =&gt; {
        asyncFunc3(opt, (...args3) =&gt; {
            asyncFunc4(opt, (...args4) =&gt; {
                // some operation
            });
        });
    });
});
</code></pre>

<p>å·¦ä¾§æ˜æ˜¾å‡ºç°äº†ä¸€ä¸ªä¸‰è§’å½¢çš„ç¼©è¿›åŒºåŸŸï¼Œè¿‡å¤šçš„å›è°ƒä¹Ÿå°±è®©æˆ‘ä»¬é™·å…¥â€œå›è°ƒåœ°ç‹±â€ã€‚æ¥ä¸‹æ¥ä¼šä»‹ç»ä¸€äº›æ–¹æ³•æ¥è§„é¿å›è°ƒåœ°ç‹±ã€‚</p>

<h2 id="toc_0">ä¸€ã€æ‹†è§£function</h2>

<p>å›è°ƒåµŒå¥—æ‰€å¸¦æ¥çš„ä¸€ä¸ªé‡è¦é—®é¢˜å°±æ˜¯ä»£ç ä¸æ˜“é˜…è¯»ä¸ç»´æŠ¤ã€‚å› ä¸ºæ™®éæ¥è¯´ï¼Œè¿‡å¤šçš„ç¼©è¿›ï¼ˆåµŒå¥—ï¼‰ä¼šæå¤§çš„å½±å“ä»£ç çš„å¯è¯»æ€§ã€‚åŸºäºè¿™ä¸€ç‚¹ï¼Œå¯ä»¥è¿›è¡Œä¸€ä¸ªæœ€ç®€å•çš„ä¼˜åŒ–â€”â€”å°†å„æ­¥æ‹†è§£ä¸ºå•ä¸ªçš„<code>function</code></p>

<pre><code class="language-javascript">function getData(count) {
    get(`/sampleget?count=${count}`, data =&gt; {
        console.log(data);
    });
}

function queryDB(kw) {
    db.find(`select * from sample where kw = ${kw}`, (err, res) =&gt; {
        getData(res.length);
    });
}

function readFile(filepath) {
    fs.readFile(filepath, &#39;utf-8&#39;, (err, content) =&gt; {
        let keyword = content.substring(0, 5);
        queryDB(keyword);
    });
}

readFile(&#39;./sample.txt&#39;);
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä¸Šé¢çš„æ”¹å†™æ–¹å¼ï¼Œä»£ç æ¸…æ™°äº†è®¸å¤šã€‚è¯¥æ–¹æ³•éå¸¸ç®€å•ï¼Œå…·æœ‰ä¸€å®šçš„æ•ˆæœï¼Œä½†æ˜¯ç¼ºå°‘é€šç”¨æ€§ã€‚</p>

<h2 id="toc_1">äºŒã€äº‹ä»¶å‘å¸ƒ/ç›‘å¬æ¨¡å¼</h2>

<p>å¦‚æœåœ¨æµè§ˆå™¨ä¸­å†™è¿‡äº‹ä»¶ç›‘å¬<code>addEventListener</code>ï¼Œé‚£ä¹ˆä½ å¯¹è¿™ç§äº‹ä»¶å‘å¸ƒ/ç›‘å¬çš„æ¨¡å¼ä¸€å®šä¸é™Œç”Ÿã€‚</p>

<p>å€Ÿé‰´è¿™ç§æ€æƒ³ï¼Œä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬æŸä¸€äº‹ä»¶ï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¿›è¡Œç›¸åº”å›è°ƒæ“ä½œï¼›å¦ä¸€æ–¹é¢ï¼Œå½“æŸäº›æ“ä½œå®Œæˆåï¼Œé€šè¿‡å‘å¸ƒäº‹ä»¶è§¦å‘å›è°ƒã€‚è¿™æ ·å°±å¯ä»¥å°†åŸæœ¬æ†ç»‘åœ¨ä¸€èµ·çš„ä»£ç è§£è€¦ã€‚</p>

<pre><code class="language-javascript">const events = require(&#39;events&#39;);
const eventEmitter = new events.EventEmitter();

eventEmitter.on(&#39;db&#39;, (err, kw) =&gt; {
    db.find(`select * from sample where kw = ${kw}`, (err, res) =&gt; {
        eventEmitter(&#39;get&#39;, res.length);
    });
});

eventEmitter.on(&#39;get&#39;, (err, count) =&gt; {
    get(`/sampleget?count=${count}`, data =&gt; {
        console.log(data);
    });
});

fs.readFile(&#39;./sample.txt&#39;, &#39;utf-8&#39;, (err, content) =&gt; {
    let keyword = content.substring(0, 5);
    eventEmitter. emit(&#39;db&#39;, keyword);
});
</code></pre>

<p>ä½¿ç”¨è¿™ç§æ¨¡å¼çš„å®ç°éœ€è¦ä¸€ä¸ªäº‹ä»¶å‘å¸ƒ/ç›‘å¬çš„åº“ã€‚ä¸Šé¢ä»£ç ä¸­ä½¿ç”¨nodeåŸç”Ÿçš„<code>events</code>æ¨¡å—ï¼Œå½“ç„¶ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„åº“ã€‚</p>

<h2 id="toc_2">ä¸‰ã€Promise</h2>

<p><code>Promise</code>æ˜¯ä¸€ç§å¼‚æ­¥è§£å†³æ–¹æ¡ˆï¼Œæœ€æ—©ç”±ç¤¾åŒºæå‡ºå¹¶å®ç°ï¼Œåæ¥å†™è¿›äº†es6è§„èŒƒã€‚</p>

<p>ç›®å‰ä¸€äº›ä¸»æµçš„æµè§ˆå™¨å·²ç»åŸç”Ÿå®ç°äº†<code>Promise</code>çš„APIï¼Œå¯ä»¥åœ¨<a href="https://caniuse.com/#search=promise">Can I use</a>é‡ŒæŸ¥çœ‹æµè§ˆå™¨çš„æ”¯æŒæƒ…å†µã€‚å½“ç„¶ï¼Œå¦‚æœæƒ³è¦åšæµè§ˆå™¨çš„å…¼å®¹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€äº›<code>Promise</code>çš„å®ç°åº“ï¼Œä¾‹å¦‚<a href="https://github.com/petkaantonov/bluebird">bluebird</a>ã€ <a href="https://github.com/kriskowal/q">Q</a>ç­‰ã€‚ä¸‹é¢ä»¥bluebirdä¸ºä¾‹ï¼š</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†å¼‚æ­¥æ–¹æ³•æ”¹å†™ä¸º<code>Promise</code>ï¼Œå¯¹äºç¬¦åˆnodeè§„èŒƒçš„å›è°ƒå‡½æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯Errorï¼‰ï¼Œå¯ä»¥ä½¿ç”¨bluebirdçš„<code>promisify</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ ‡å‡†çš„å¼‚æ­¥æ–¹æ³•å¹¶è¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚</p>

<pre><code class="language-javascript">const bluebird = require(&#39;bluebird&#39;);
const fs = require(&quot;fs&quot;);
const readFile = bluebird.promisify(fs.readFile);
</code></pre>

<p>è¿™æ ·ï¼Œ<code>readFile</code>å°±å˜æˆäº†ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚</p>

<p>ä½†æ˜¯ï¼Œæœ‰çš„å¼‚æ­¥æ–¹æ³•æ— æ³•è¿›è¡Œè½¬æ¢ï¼Œæˆ–è€…æˆ‘ä»¬éœ€è¦ä½¿ç”¨åŸç”Ÿ<code>Promise</code>ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œä¸€äº›æ”¹é€ ã€‚ä¸‹é¢æä¾›ä¸€ç§æ”¹é€ çš„æ–¹æ³•ã€‚</p>

<p>ä»¥<code>fs.readFile</code>ä¸ºä¾‹ï¼Œå€ŸåŠ©åŸç”Ÿ<code>Promise</code>æ¥æ”¹é€ è¯¥æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">const readFile = function (filepath) {
    let resolve,
        reject;
    let promise = new Promise((_resolve, _reject) =&gt; {
        resolve = _resolve;
        reject = _reject;
    });
    let deferred = {
        resolve,
        reject,
        promise
    };
    fs.readFile(filepath, &#39;utf-8&#39;, function (err, ...args) {
        if (err) {
            deferred.reject(err);
        }
        else {
            deferred.resolve(...args);
        }
    });
    return deferred.promise;
}
</code></pre>

<p>æˆ‘ä»¬åœ¨æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ï¼Œå¹¶åœ¨å¼‚æ­¥å›è°ƒä¸­æ ¹æ®ä¸åŒçš„æƒ…å†µä½¿ç”¨<code>reject</code>ä¸<code>resolve</code>æ¥æ”¹å˜<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€ã€‚è¯¥æ–¹æ³•è¿”å›è¿™ä¸ª<code>Promise</code>å¯¹è±¡ã€‚å…¶ä»–çš„ä¸€äº›å¼‚æ­¥æ–¹æ³•ä¹Ÿå¯ä»¥å‚ç…§è¿™ç§æ–¹å¼è¿›è¡Œæ”¹é€ ã€‚</p>

<p>å‡è®¾é€šè¿‡æ”¹é€ ï¼Œ<code>readFile</code>ã€<code>queryDB</code>ä¸<code>getData</code>æ–¹æ³•å‡ä¼šè¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚ä»£ç å°±å˜ä¸ºäº†ï¼š</p>

<pre><code class="language-javascript">readFile(&#39;./sample.txt&#39;).then(content =&gt; {
    let keyword = content.substring(0, 5);
    return queryDB(keyword);
}).then(res =&gt; {
    return getData(res.length);
}).then(data =&gt; {
    console.log(data);
}).catch(err =&gt; {
    console.warn(err);
});
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä¹‹å‰çš„åµŒå¥—æ“ä½œç¼–ç¨‹äº†é€šè¿‡<code>then</code>è¿æ¥çš„é“¾å¼æ“ä½œã€‚ä»£ç çš„æ•´æ´åº¦ä¸Šæœ‰äº†ä¸€ä¸ªè¾ƒå¤§çš„æé«˜ã€‚</p>

<h2 id="toc_3">å››ã€generator</h2>

<p><code>generator</code>æ˜¯es6ä¸­çš„ä¸€ä¸ªæ–°çš„è¯­æ³•ã€‚åœ¨<code>function</code>å…³é”®å­—åæ·»åŠ *å³å¯å°†å‡½æ•°å˜ä¸º<code>generator</code>ã€‚</p>

<pre><code class="language-javascript">const gen = function* () {
    yield 1;
    yield 2;
    return 3;
}
</code></pre>

<p>æ‰§è¡Œ<code>generator</code>å°†ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äºéå†<code>generator</code>å†…éƒ¨çš„çŠ¶æ€ã€‚</p>

<pre><code class="language-javascript">let g = gen();
g.next(); // { value: 1, done: false }
g.next(); // { value: 2, done: false }
g.next(); // { value: 3, done: true }
g.next(); // { value: undefined, done: true }
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>generator</code>å‡½æ•°æœ‰ä¸€ä¸ªæœ€å¤§çš„ç‰¹ç‚¹ï¼Œå¯ä»¥åœ¨å†…éƒ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­äº¤å‡ºç¨‹åºçš„æ§åˆ¶æƒï¼Œ<code>yield</code>ç›¸å½“äºèµ·åˆ°äº†ä¸€ä¸ªæš‚åœçš„ä½œç”¨ï¼›è€Œå½“ä¸€å®šæƒ…å†µä¸‹ï¼Œå¤–éƒ¨åˆå°†æ§åˆ¶æƒå†ç§»äº¤å›æ¥ã€‚</p>

<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç”¨<code>generator</code>æ¥å°è£…ä»£ç ï¼Œåœ¨å¼‚æ­¥ä»»åŠ¡å¤„ä½¿ç”¨<code>yield</code>å…³é”®è¯ï¼Œæ­¤æ—¶<code>generator</code>ä¼šå°†ç¨‹åºæ‰§è¡Œæƒäº¤ç»™å…¶ä»–ä»£ç ï¼Œè€Œåœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆåï¼Œè°ƒç”¨<code>next</code>æ–¹æ³•æ¥æ¢å¤<code>yield</code>ä¸‹æ–¹ä»£ç çš„æ‰§è¡Œã€‚ä»¥readFileä¸ºä¾‹ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-javascript">// æˆ‘ä»¬çš„ä¸»ä»»åŠ¡â€”â€”æ˜¾ç¤ºå…³é”®å­—
// ä½¿ç”¨yieldæš‚æ—¶ä¸­æ–­ä¸‹æ–¹ä»£ç æ‰§è¡Œ
// yieldåé¢ä¸ºpromiseå¯¹è±¡
const showKeyword = function* (filepath) {
    console.log(&#39;å¼€å§‹è¯»å–&#39;);
    let keyword = yield readFile(filepath);
    console.log(`å…³é”®å­—ä¸º${filepath}`);
}

// generatorçš„æµç¨‹æ§åˆ¶
let gen = showKeyword();
let res = gen.next();
res.value.then(res =&gt; gen.next(res));
</code></pre>

<p>åœ¨ä¸»ä»»åŠ¡éƒ¨åˆ†ï¼ŒåŸæœ¬<code>readFile</code>å¼‚æ­¥çš„éƒ¨åˆ†å˜æˆäº†ç±»ä¼¼åŒæ­¥çš„å†™æ³•ï¼Œä»£ç å˜å¾—éå¸¸æ¸…æ™°ã€‚è€Œåœ¨ä¸‹åŠéƒ¨åˆ†ï¼Œåˆ™æ˜¯å¯¹äºä»€ä¹ˆæ—¶å€™éœ€è¦ç§»äº¤å›æ§åˆ¶æƒç»™<code>generator</code>çš„æµç¨‹æ§åˆ¶ã€‚</p>

<p>ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ§åˆ¶<code>generator</code>çš„æµç¨‹ï¼Œå¦‚æœèƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œ<code>generator</code>â€”â€”åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨ç§»äº¤æ§åˆ¶æƒï¼Œé‚£ä¹ˆä¼šæ›´åŠ å…·æœ‰å®ç”¨æ€§ã€‚</p>

<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://github.com/tj/co">co</a> è¿™ä¸ªåº“ã€‚å®ƒå¯ä»¥æ˜¯çœå»æˆ‘ä»¬å¯¹äº<code>generator</code>æµç¨‹æ§åˆ¶çš„ä»£ç </p>

<pre><code class="language-javascript">const co = reuqire(&#39;co&#39;);
// æˆ‘ä»¬çš„ä¸»ä»»åŠ¡â€”â€”æ˜¾ç¤ºå…³é”®å­—
// ä½¿ç”¨yieldæš‚æ—¶ä¸­æ–­ä¸‹æ–¹ä»£ç æ‰§è¡Œ
// yieldåé¢ä¸ºpromiseå¯¹è±¡
const showKeyword = function* (filepath) {
    console.log(&#39;å¼€å§‹è¯»å–&#39;);
    let keyword = yield readFile(filepath);
    console.log(`å…³é”®å­—ä¸º${filepath}`);
}

// ä½¿ç”¨co
co(showKeyword);
</code></pre>

<p>å…¶ä¸­ï¼Œ<code>yeild</code>å…³é”®å­—åé¢éœ€è¦æ˜¯<code>functio</code>, <code>promise</code>, <code>generator</code>, <code>array</code>æˆ–<code>object</code>ã€‚å¯ä»¥æ”¹å†™æ–‡ç« ä¸€å¼€å§‹çš„ä¾‹å­ï¼š</p>

<pre><code class="language-javascript">const co = reuqire(&#39;co&#39;);

const task = function* (filepath) {
   let keyword = yield readFile(filepath);
   let count = yield queryDB(keyword);
   let data = yield getData(res.length);
   console.log(data);
});

co(task, &#39;./sample.txt&#39;);
</code></pre>

<h2 id="toc_4">äº”ã€async/await</h2>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„æ–¹æ³•è™½ç„¶éƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†å¼‚æ­¥ç¼–ç¨‹ä¸­å›è°ƒå¸¦æ¥çš„é—®é¢˜ã€‚ç„¶è€Œ<br/>
- functionæ‹†åˆ†çš„æ–¹å¼å…¶å®ä»…ä»…åªæ˜¯æ‹†åˆ†ä»£ç å—ï¼Œæ—¶å¸¸ä¼šä¸åˆ©äºåç»­ç»´æŠ¤ï¼›<br/>
- äº‹ä»¶å‘å¸ƒ/ç›‘å¬æ–¹å¼æ¨¡ç³Šäº†å¼‚æ­¥æ–¹æ³•ä¹‹é—´çš„æµç¨‹å…³ç³»ï¼›<br/>
- <code>Promise</code>è™½ç„¶ä½¿å¾—å¤šä¸ªåµŒå¥—çš„å¼‚æ­¥è°ƒç”¨èƒ½å¤Ÿé€šè¿‡é“¾å¼çš„APIè¿›è¡Œæ“ä½œï¼Œä½†æ˜¯è¿‡å¤šçš„<code>then</code>ä¹Ÿå¢åŠ äº†ä»£ç çš„å†—ä½™ï¼Œä¹Ÿå¯¹é˜…è¯»ä»£ç ä¸­å„é˜¶æ®µçš„å¼‚æ­¥ä»»åŠ¡äº§ç”Ÿäº†ä¸€å®šå¹²æ‰°ï¼›<br/>
- é€šè¿‡<code>generator</code>è™½ç„¶èƒ½æä¾›è¾ƒå¥½çš„è¯­æ³•ç»“æ„ï¼Œä½†æ˜¯æ¯•ç«Ÿ<code>generator</code>ä¸<code>yield</code>çš„è¯­å¢ƒç”¨åœ¨è¿™é‡Œå¤šå°‘è¿˜æœ‰äº›ä¸å¤ªè´´åˆ‡ã€‚</p>

<p>å› æ­¤ï¼Œè¿™é‡Œå†ä»‹ç»ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå°±æ˜¯es7ä¸­çš„async/awaitã€‚</p>

<p>ç®€å•ä»‹ç»ä¸€ä¸‹async/awaitã€‚åŸºæœ¬ä¸Šï¼Œä»»ä½•ä¸€ä¸ªå‡½æ•°éƒ½å¯ä»¥æˆä¸ºasyncå‡½æ•°ï¼Œä»¥ä¸‹éƒ½æ˜¯åˆæ³•çš„ä¹¦å†™å½¢å¼ï¼š</p>

<pre><code class="language-javascript">async function foo () {};
const foo = async function () {};
const foo = async () =&gt; {};
</code></pre>

<p>åœ¨<code>async</code>å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨<code>await</code>è¯­å¥ã€‚<code>await</code>åä¸€èˆ¬æ˜¯ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚</p>

<pre><code class="language-javascript">async function foo () {
    console.log(&#39;å¼€å§‹&#39;);
    let res = await post(data);
    console.log(`postå·²å®Œæˆï¼Œç»“æœä¸ºï¼š${res}`);
};
</code></pre>

<p>å½“ä¸Šé¢çš„å‡½æ•°æ‰§è¡Œåˆ°<code>await</code>æ—¶ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œå‡½æ•°æŒ‚èµ·ï¼Œç­‰å¾…<code>await</code>åçš„<code>Promise</code>è¿”å›ï¼Œå†æ‰§è¡Œä¸‹é¢çš„è¯­å¥ã€‚</p>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™æ®µå¼‚æ­¥æ“ä½œçš„ä»£ç ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯â€œåŒæ­¥æ“ä½œâ€ã€‚è¿™å°±å¤§å¤§æ–¹ä¾¿äº†å¼‚æ­¥ä»£ç çš„ç¼–å†™ä¸é˜…è¯»ã€‚ä¸‹é¢æ”¹å†™æˆ‘ä»¬çš„ä¾‹å­ã€‚</p>

<pre><code class="language-javascript">const printData = async function (filepath) {
   let keyword = await readFile(filepath);
   let count = await queryDB(keyword);
   let data = await getData(res.length);
   console.log(data);
});

printData(&#39;./sample.txt&#39;);
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ç®€æ´æ¸…æ™°ï¼Œå¼‚æ­¥ä»£ç ä¹Ÿå…·æœ‰äº†â€œåŒæ­¥â€ä»£ç çš„ç»“æ„ã€‚</p>

<p>æ³¨æ„ï¼Œå…¶ä¸­<code>readFile</code>ã€<code>queryDB</code>ä¸<code>getData</code>æ–¹æ³•éƒ½éœ€è¦è¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ç¬¬ä¸‰éƒ¨åˆ†<code>Promise</code>é‡Œæä¾›çš„æ–¹å¼è¿›è¡Œæ”¹å†™ã€‚</p>

<h2 id="toc_5">åè®°</h2>

<p>å¼‚æ­¥ç¼–ç¨‹ä½œä¸ºJavaScriptä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå…·æœ‰éå¸¸é‡è¦çš„ä½ç½®ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬é¿å…åŒæ­¥ä»£ç å¸¦æ¥çš„çº¿ç¨‹é˜»å¡çš„åŒæ—¶ï¼Œä¹Ÿä¸ºç¼–ç ä¸é˜…è¯»å¸¦æ¥äº†ä¸€å®šçš„å›°éš¾ã€‚è¿‡å¤šçš„å›è°ƒåµŒå¥—å¾ˆå®¹æ˜“ä¼šè®©æˆ‘ä»¬é™·å…¥â€œå›è°ƒåœ°ç‹±â€ä¸­ï¼Œä½¿ä»£ç å˜æˆä¸€å›¢ä¹±éº»ã€‚ä¸ºäº†è§£å†³â€œå›è°ƒåœ°ç‹±â€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–‡ä¸­æ‰€è¿°çš„è¿™äº”ç§å¸¸ç”¨æ–¹æ³•ï¼š</p>

<ul>
<li>functionæ‹†è§£</li>
<li>äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼</li>
<li>Promise</li>
<li>Generator</li>
<li>async / await</li>
</ul>

<p>ç†è§£å„ç±»æ–¹æ³•çš„åŸç†ä¸å®ç°æ–¹å¼ï¼Œäº†è§£å…¶ä¸­åˆ©å¼Šï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½å¾—è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹ã€‚</p>

<hr/>

<h2 id="toc_6">Happy Codingï¼</h2>

<hr/>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15236404711802.html"  title="Previous Post: æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»">&laquo; æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15236396803035.html" 
	        title="Next Post: ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15236403350295.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
