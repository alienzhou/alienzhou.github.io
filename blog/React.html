<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  React - AlienZHOU's blog
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="AlienZHOU's blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">AlienZHOU's blog</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; AlienZHOU's blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>PWA</label></li>

          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜" href="15235166926023.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨" href="15235151669706.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€" href="15235140795593.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…" href="15235138633619.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…</a></li>
          

      
        <li class="divider"></li>
        <li><label>React</label></li>

          
            <li><a title="åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ" href="15236392559880.html">åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</a></li>
          
            <li><a title="åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰" href="15235187668595.html">åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</a></li>
          

      
        <li class="divider"></li>
        <li><label>CSS</label></li>

          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘" href="15236398426783.html">ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘</a></li>
          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS" href="15236396803035.html">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS</a></li>
          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope" href="15236395841604.html">ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a></li>
          

      
        <li class="divider"></li>
        <li><label>Server</label></li>

          
            <li><a title="ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹" href="15236400113573.html">ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a></li>
          

      
        <li class="divider"></li>
        <li><label>Automation</label></li>

          
            <li><a title="Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—" href="15236401468681.html">Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</a></li>
          

      
        <li class="divider"></li>
        <li><label>FE else</label></li>

          
            <li><a title="æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»" href="15236404711802.html">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a></li>
          
            <li><a title="JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ" href="15236403350295.html">JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</a></li>
          
            <li><a title="jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰" href="15236405992551.html">jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>PWA</span></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜" href="15235166926023.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨" href="15235151669706.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€" href="15235140795593.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…" href="15235138633619.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…</a></li>
                        

                    
                      <li class="side-title"><span>React</span></li>
                        
                          <li><a title="åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ" href="15236392559880.html">åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</a></li>
                        
                          <li><a title="åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰" href="15235187668595.html">åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</a></li>
                        

                    
                      <li class="side-title"><span>CSS</span></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘" href="15236398426783.html">ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘</a></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS" href="15236396803035.html">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS</a></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope" href="15236395841604.html">ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a></li>
                        

                    
                      <li class="side-title"><span>Server</span></li>
                        
                          <li><a title="ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹" href="15236400113573.html">ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a></li>
                        

                    
                      <li class="side-title"><span>Automation</span></li>
                        
                          <li><a title="Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—" href="15236401468681.html">Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</a></li>
                        

                    
                      <li class="side-title"><span>FE else</span></li>
                        
                          <li><a title="æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»" href="15236404711802.html">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a></li>
                        
                          <li><a title="JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ" href="15236403350295.html">JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</a></li>
                        
                          <li><a title="jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰" href="15236405992551.html">jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 


	
		<div class="markdown-body">
		<h1>åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</h1>

		<h2 id="toc_0">æ¦‚è¿°</h2>

<p>æœ¬ç¯‡æ–‡ç« ä½¿ç”¨create-react-appä½œä¸ºè„šæ‰‹æ¶ï¼Œç»“åˆreactæŠ€æœ¯æ ˆï¼ˆreact + redux + react-routerï¼‰ï¼Œæ„å»ºä¸€ä¸ªç®€å•çš„å•é¡µé¢åº”ç”¨demoã€‚æ–‡ç« ä¼šä¸€æ­¥æ­¥åœ°è®²è§£å¦‚ä½•æ„å»ºè¿™ä¹ˆä¸€ä¸ªå•é¡µåº”ç”¨ã€‚<strong><em>æ–‡ç« çš„æœ€åä¹Ÿä¼šç»™å‡ºç›¸åº”çš„demoåœ°å€</em></strong>ã€‚</p>

<p>æœ¬æ–‡ä¸»è¦æ˜¯å¯¹SPAæ­å»ºçš„å®è·µè¿‡ç¨‹è®²è§£ï¼Œåœ¨å¯¹reactã€reduxã€react-routeræœ‰äº†åˆæ­¥äº†è§£åï¼Œæ¥è¿ç”¨è¿™äº›æŠ€æœ¯æ„å»ºä¸€ä¸ªç®€å•çš„å•é¡µåº”ç”¨ã€‚è¿™ä¸ªåº”ç”¨åŒ…æ‹¬äº†ä¾§è¾¹å¯¼èˆªæ ä¸ä¸»ä½“å†…å®¹åŒºåŸŸã€‚ä¸‹é¢ç®€å•ç½—åˆ—äº†å°†ä¼šç”¨åˆ°çš„ä¸€äº›æ¡†æ¶ä¸å·¥å…·ã€‚</p>

<ul>
<li>create-react-appï¼šè„šæ‰‹æ¶</li>
<li>reactï¼šè´Ÿè´£é¡µé¢ç»„ä»¶æ„å»º</li>
<li>react-routerï¼šè´Ÿè´£å•é¡µåº”ç”¨è·¯ç”±éƒ¨åˆ†çš„æ§åˆ¶</li>
<li>reduxï¼šè´Ÿè´£ç®¡ç†æ•´ä¸ªåº”ç”¨çš„æ•°æ®æµ</li>
<li>react-reduxï¼šå°†reactä¸reduxè¿™ä¸¤éƒ¨åˆ†ç›¸ç»“åˆ</li>
<li>redux-thunkï¼šreduxçš„ä¸€ä¸ªä¸­é—´ä»¶ã€‚å¯ä»¥ä½¿action creatorè¿”å›ä¸€ä¸ª<code>function</code>ï¼ˆè€Œä¸ä»…ä»…æ˜¯<code>object</code>ï¼‰ï¼Œå¹¶ä¸”ä½¿å¾—dispatchæ–¹æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ª<code>function</code>ä½œä¸ºå‚æ•°ï¼Œé€šè¿‡è¿™ç§æ”¹é€ ä½¿å¾—actionæ”¯æŒå¼‚æ­¥ï¼ˆæˆ–å»¶è¿Ÿï¼‰æ“ä½œ</li>
<li>redux-actionsï¼šé’ˆå¯¹reduxçš„ä¸€ä¸ªFSAå·¥å…·ç®±ï¼Œå¯ä»¥ç›¸åº”ç®€åŒ–ä¸æ ‡å‡†åŒ–actionä¸reduceréƒ¨åˆ†</li>
</ul>

<p>å¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œä¸€èµ·æ¥æ„å»ºä½ çš„å•é¡µåº”ç”¨å§ã€‚</p>

<h2 id="toc_1">ä½¿ç”¨create-react-appè„šæ‰‹æ¶</h2>

<p><a href="https://github.com/facebookincubator/create-react-app">create-react-app</a>æ˜¯Facebookå®˜æ–¹å‡ºå“çš„è„šæ‰‹æ¶ã€‚æœ‰äº†å®ƒï¼Œä½ åªéœ€è¦ä¸€è¡ŒæŒ‡ä»¤å³å¯è·³è¿‡webpackç¹ççš„é…ç½®ã€npmç¹å¤šçš„å¼•å…¥ç­‰è¿‡ç¨‹ï¼Œè¿…é€Ÿæ„å»ºreacté¡¹ç›®ã€‚</p>

<p>é¦–å…ˆå®‰è£…create-react-app</p>

<pre><code class="language-bash">npm i -g create-react-app
</code></pre>

<p>å®‰è£…å®Œæˆåï¼Œå°±å¯ä»¥ä½¿ç”¨<code>create-react-app</code>æŒ‡ä»¤å¿«é€Ÿåˆ›å»ºä¸€ä¸ªåŸºäºwebpackçš„reactåº”ç”¨ç¨‹åº</p>

<pre><code class="language-bash">cd $your_dir
create-react-app react-redux-demo
</code></pre>

<p>è¿™æ—¶ä½ å¯ä»¥è¿›å…¥<code>react-redux-demo</code>è¿™ä¸ªç›®å½•ï¼Œè¿è¡Œ<code>npm start</code>æ—¢å¯å¯åŠ¨è¯¥åº”ç”¨ã€‚</p>

<p>æ‰“å¼€è®¿é—®<code>localhost:3000</code>çœ‹åˆ°ä¸‹æ–¹å¯¹åº”çš„é¡µé¢ï¼Œå°±è¯´æ˜é¡¹ç›®åŸºç¡€æ¡†æ¶åˆ›å»ºå®Œæ¯•äº†ã€‚<br/>
<img src="http://upload-images.jianshu.io/upload_images/6476654-ceeeda7ba166a8fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯åŠ¨é¡µé¢"/></p>

<h2 id="toc_2">åˆ›å»ºReactç»„ä»¶</h2>

<h3 id="toc_3">ä¿®æ”¹ç›®å½•ç»“æ„</h3>

<p>ä¸‹é¢åœ¨æˆ‘ä»¬çš„react-redux-demoé¡¹ç›®ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç›¸åº”çš„ç›®å½•ç»“æ„</p>

<pre><code>|--public
    |--index.html
    |-- â€¦â€¦
|--src
    |--App.js
    |--index.js
    |-- â€¦â€¦
|--node_modules
</code></pre>

<p>å…¶ä¸­<code>public</code>ä¸­å­˜æ”¾çš„å†…å®¹ä¸ä¼šè¢«webpackç¼–è¯‘ï¼Œæ‰€ä»¥å¯ä»¥æ”¾ä¸€äº›é™æ€é¡µé¢æˆ–å›¾ç‰‡ï¼›<code>src</code>ä¸­å­˜æ”¾çš„å†…å®¹æ‰ä¼šè¢«webpackæ‰“åŒ…ç¼–è¯‘ï¼Œæˆ‘ä»¬ä¸»è¦å·¥ä½œçš„ç›®å½•å°±æ˜¯åœ¨<code>src</code>ä¸‹ã€‚</p>

<p>äº†è§£reactçš„åŒå­¦è‚¯å®šçŸ¥é“ï¼Œåœ¨reactä¸­æˆ‘ä»¬é€šè¿‡æ„å»ºå„ç§<code>react component</code>æ¥å®ç°ä¸€ä¸ªæ–°çš„ä¸–ç•Œã€‚åœ¨æˆ‘ä»¬çš„é¡¹ç›®é‡Œï¼Œä¼šåŸºäºæ­¤ï¼Œå°†ç»„ä»¶åˆ†ä¸ºé€šç”¨ç»„ä»¶éƒ¨åˆ†ä¸é¡µé¢ç»„ä»¶éƒ¨åˆ†ã€‚é€šç”¨ç»„ä»¶ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ™®éæ„ä¹‰ä¸Šçš„ç»„ä»¶ï¼Œä¸€äº›å¤§å‹é¡¹ç›®ä¼šç»´æŠ¤ä¸€ä¸ªè‡ªå·±çš„ç»„ä»¶åº“ï¼Œå…¶ä¸­çš„ç»„ä»¶ä¼šè¢«æ•´ä¸ªé¡¹ç›®å…±äº«ï¼›é¡µé¢ç»„ä»¶å®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­æ‰€å‘ˆç°å‡ºæ¥çš„å„ä¸ªé¡µé¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®å½•ä¼šå˜æˆè¿™æ ·</p>

<pre><code>|--public
      |--index.html
      |-- â€¦â€¦
|--src
    |--page
         |--welcome.js
         |--goods.js
    |--component
         |--nav
             |--index.js
             |--index.css
    |--App.js
    |--index.js
    |-- â€¦â€¦
|--node_modules
</code></pre>

<p>åœ¨<code>src</code>ç›®å½•ä¸‹æ–°å»ºäº†<code>page</code>å’Œ<code>component</code>ä¸¤ä¸ªç›®å½•åˆ†åˆ«ç”¨äºå­˜æ”¾é¡µé¢ç»„ä»¶å’Œé€šç”¨ç»„ä»¶ã€‚é¡µé¢ç»„ä»¶åŒ…æ‹¬<code>welcome.js</code>å’Œå•†å“åˆ—è¡¨é¡µ<code>good.js</code>ï¼Œé€šç”¨ç»„ä»¶åŒ…æ‹¬äº†ä¸€ä¸ªå¯¼èˆªæ <code>nav</code>ã€‚</p>

<h3 id="toc_4">ä¸¤ç§ç»„ä»¶å½¢å¼</h3>

<p>ç¼–å†™é¡µé¢æˆ–ç»„ä»¶ï¼Œç±»ä¼¼äºé™æ€é¡µçš„å¼€å‘ã€‚æ¨èçš„ç»„ä»¶å†™æ³•æœ‰ä¸¤ç§ï¼š</p>

<p><strong>1ï¼‰çº¯å‡½æ•°å½¢å¼</strong>ï¼šè¯¥ç±»ç»„ä»¶ä¸ºæ— çŠ¶æ€ç»„ä»¶ã€‚ç”±äºä½¿ç”¨å‡½æ•°æ¥å®šä¹‰ï¼Œå› æ­¤ä¸èƒ½è®¿é—®<code>this</code>å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œåªèƒ½è®¿é—®<code>props</code>ã€‚è¿™ç±»ç»„ä»¶ä¸»è¦æ˜¯ä¸€äº›çº¯å±•ç¤ºç±»çš„å°ç»„ä»¶ï¼Œé€šè¿‡å°†è¿™äº›å°ç»„ä»¶è¿›è¡Œç»„åˆæ„æˆæ›´ä¸ºå¤æ‚çš„ç»„ä»¶ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">const Title = props =&gt; (
    &lt;h1&gt;
        {props.title} - {props.subtitle}
    &lt;/h1&gt;
)
</code></pre>

<p><strong>2ï¼‰es6å½¢å¼çš„ç»„ä»¶</strong>ï¼šè¯¥ç±»ç»„ä»¶ä¸€èˆ¬ä¸ºå¤æ‚çš„æˆ–æœ‰çŠ¶æ€ç»„ä»¶ã€‚ä½¿ç”¨es6çš„classè¯­æ³•è¿›è¡Œåˆ›å»ºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨é¡µé¢/ç»„ä»¶ä¸­ä½¿ç”¨<code>this</code>æ³¨æ„å…¶æŒ‡å‘ï¼Œå¿…è¦æ—¶éœ€è¦ç»‘å®šã€‚ç»‘å®šæ–¹æ³•å¯ä»¥ä½¿ç”¨<code>bind</code>å‡½æ•°æˆ–ç®­å¤´å‡½æ•°ã€‚åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p>

<pre><code class="language-javascript">class Title extends Component {
    constructor(props) {
        super(props);
        this.state = {
            shown: true
        };
    }
    
    render() {
        let style = {
            display: this.state.shown ? &#39;block&#39; : none
        };
        return (
            &lt;h1 style={style}&gt;
                {props.title} - {props.subtitle}
            &lt;/h1&gt;
        );
    }
}
</code></pre>

<p>ä¸‹é¢æ˜¯è¿™ä¸¤ç§ç»„ä»¶ä¹‹é—´çš„å¯¹æ¯”ï¼š</p>

<table>
<thead>
<tr>
<th>Â </th>
<th>Presentational Components</th>
<th>Container Components</th>
</tr>
</thead>

<tbody>
<tr>
<td>Purpose</td>
<td>How things look (markup, styles)</td>
<td>How things work (data fetching, state updates)</td>
</tr>
<tr>
<td>Aware of Redux</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>To read data</td>
<td>Read data from props</td>
<td>Subscribe to Redux state</td>
</tr>
<tr>
<td>To change data</td>
<td>Invoke callbacks from props</td>
<td>Dispatch Redux actions</td>
</tr>
<tr>
<td>Are written</td>
<td>By hand</td>
<td>Usually generated by React Redux</td>
</tr>
</tbody>
</table>

<p>é‰´äºä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¼èˆªæ <code>nav</code>ç¼–å†™ä¸ºæ— çŠ¶æ€ç»„ä»¶ï¼Œè€Œ<code>page</code>ä¸­çš„éƒ¨åˆ†ä½¿ç”¨æœ‰çŠ¶æ€çš„ç»„ä»¶ã€‚</p>

<p>å¯¼èˆªæ ç»„ä»¶<code>nav</code></p>

<pre><code class="language-javascript">// component/nav/index.css
.nav {
    margin: 30px;
    padding: 0;
}
.nav li {
    border-left: 5px solid sandybrown;
    margin: 15px 0;
    padding: 6px 0;
    color: #333;
    list-style: none;
    background: #bbb;
}

// component/nav/index.js
import React from &#39;react&#39;;
import &#39;./index.css&#39;;

const Nav = props =&gt; (
    &lt;ul className=&quot;nav&quot;&gt;
        {
            props.list.map((ele, idx) =&gt; (
                &lt;li key={idx}&gt;{ele.text}&lt;/li&gt;
            ))
        }
    &lt;/ul&gt;
);

export default Nav;
</code></pre>

<p>ä¿®æ”¹åçš„<code>App.js</code>ä¸<code>App.css</code></p>

<pre><code class="language-javascript">// App.css
.App {
    text-align: center;
}
.App::after {
    clear: both;
}
.nav_bar {
    float: left;
    width: 300px;
}
.conent {
    margin-left: 300px;
    padding: 30px;
}

// App.js
import React, { Component } from &#39;react&#39;;
import Nav from &#39;./component/nav&#39;;
import Welcome from &#39;./page/welcome&#39;;
import Goods from &#39;./page/goods&#39;;
import &#39;./App.css&#39;;

const LIST = [{
    text: &#39;welcome&#39;,
    url: &#39;/welcome&#39;
}, {
    text: &#39;goods&#39;,
    url: &#39;/goods&#39;
}];

const GOODS = [{
    name: &#39;iPhone 7&#39;,
    price: &#39;6,888&#39;,
    amount: 37
}, {
    name: &#39;iPad&#39;,
    price: &#39;3,488&#39;,
    amount: 82
}, {
    name: &#39;MacBook Pro&#39;,
    price: &#39;11,888&#39;,
    amount: 15
}];

class App extends Component {
    render() {
        return (
            &lt;div className=&quot;App&quot;&gt;
                &lt;div className=&quot;nav_bar&quot;&gt;
                    &lt;Nav list={LIST} /&gt;
                &lt;/div&gt;
                &lt;div className=&quot;conent&quot;&gt;
                    &lt;Welcome /&gt;
                    &lt;Goods list={GOODS} /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }
}

export default App;
</code></pre>

<p>welcomeé¡µé¢</p>

<pre><code class="language-javascript">// page/welcome.js
import React from &#39;react&#39;;

const Welcome = props =&gt; (
    &lt;h1&gt;Welcome!&lt;/h1&gt;
);

export default Welcome;
</code></pre>

<p>goodsé¡µé¢</p>

<pre><code class="language-javascript">// page/goods.js
import React, { Component } from &#39;react&#39;;

class Goods extends Component {
    render() {
        return (
            &lt;ul className=&quot;goods&quot;&gt;
                {
                    this.props.list.map((ele, idx) =&gt; (
                        &lt;li key={idx} style={{marginBottom: 20, listStyle: &#39;none&#39;}}&gt;
                            &lt;span&gt;{ele.name}&lt;/span&gt; | 
                            &lt;span&gt;ï¿¥ {ele.price}&lt;/span&gt; | 
                            &lt;span&gt;å‰©ä½™ {ele.amount} ä»¶&lt;/span&gt;
                        &lt;/li&gt;
                    ))
                }
            &lt;/ul&gt;
        );
    }
}

export default Goods;
</code></pre>

<p>ç°åœ¨æˆ‘ä»¬çš„é¡µé¢æ˜¯è¿™æ ·çš„</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-48a1dac919bf9f16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""/></p>

<h2 id="toc_5">ä½¿ç”¨reduxæ¥ç®¡ç†æ•°æ®æµ</h2>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-218811ebec26b62a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="reduxæ•°æ®æµç¤ºæ„å›¾"/><br/>
reduxæ˜¯fluxæ¶æ„çš„ä¸€ç§å®ç°ã€‚å›¾ä¸­å±•ç¤ºäº†ï¼Œåœ¨react+reduxæ¡†æ¶ä¸‹ï¼Œä¸€ä¸ªç‚¹å‡»äº‹ä»¶æ˜¯å¦‚ä½•è¿›è¡Œäº¤äº’çš„ã€‚</p>

<p>ç„¶è€Œreduxå¹¶ä¸æ˜¯å®Œå…¨ä¾é™„äºreactçš„æ¡†æ¶ï¼Œå®é™…ä¸Šreduxæ˜¯å¯ä»¥å’Œä»»ä½•UIå±‚æ¡†æ¶ç›¸ç»“åˆçš„ã€‚å› æ­¤ï¼Œä¸ºäº†æ›´å¥½å¾—ç»“åˆreduxä¸reactï¼Œå¯¹redux-flowä¸­çš„<code>store</code>æœ‰ä¸€ä¸ªæ›´å¥½çš„å…¨å±€æ€§ç®¡ç†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨<code>react-redux</code>ã€‚</p>

<pre><code class="language-bash">npm i --save redux
npm i --save react-redux
</code></pre>

<p>åŒæ—¶ï¼Œä¸ºäº†æ›´å¥½åœ°åˆ›å»ºactionå’Œreducerï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨é¡¹ç›®ä¸­å¼•å…¥<code>redux-actions</code>ï¼šä¸€ä¸ªé’ˆå¯¹reduxçš„ä¸€ä¸ªFSAå·¥å…·ç®±ï¼Œå¯ä»¥ç›¸åº”ç®€åŒ–ä¸æ ‡å‡†åŒ–actionä¸reduceréƒ¨åˆ†ã€‚å½“ç„¶ï¼Œè¿™æ˜¯å¯é€‰çš„</p>

<pre><code class="language-bash">npm i --save redux-actions
</code></pre>

<p>ä¸‹é¢æˆ‘ä»¬ä¼šä»¥goodsé¡µé¢ä¸ºä¾‹ï¼Œå®ç°ä»¥ä¸‹åœºæ™¯ï¼šgoodsé¡µé¢ç»„ä»¶æ¸²æŸ“å®Œæˆåï¼Œå‘é€è¯·æ±‚ï¼Œè·å–å•†å“åˆ—è¡¨ã€‚å…¶ä¸­è·å–æ•°æ®çš„æ–¹æ³•ä¼šä½¿ç”¨mockæ•°æ®ã€‚</p>

<p>ä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´ç›®å½•ç»“æ„</p>

<pre><code>|--public
      |--index.html
      |-- â€¦â€¦
|--src
    |--page
         |--welcome.js
         |--goods.js
    |--component
         |--nav
             |--index.js
             |--index.css
    |--action
         |--goods.js
    |--reducer
         |--goods.js
         |--index.js
    |--App.js
    |--index.js
    |-- â€¦â€¦
|--node_modules
</code></pre>

<h3 id="toc_6">é¦–å…ˆï¼Œåˆ›å»ºaction</h3>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ›å»ºå¯¹åº”çš„actionã€‚</p>

<p>actionæ˜¯ä¸€ä¸ª<code>object</code>ç±»å‹ï¼Œå¯¹äºactionçš„ç»“æ„æœ‰Fluxæœ‰ç›¸å…³çš„æ ‡å‡†åŒ–å»ºè®®<a href="https://github.com/acdlite/flux-standard-action">FSA</a><br/>
ä¸€ä¸ªactionå¿…é¡»è¦åŒ…å«<code>type</code>å±æ€§ï¼ŒåŒæ—¶å®ƒè¿˜æœ‰ä¸‰ä¸ªå¯é€‰å±æ€§<code>error</code>ã€<code>payload</code>å’Œ<code>meta</code>ã€‚<br/>
- typeå±æ€§ç›¸å½“äºæ˜¯actionçš„æ ‡è¯†ï¼Œé€šè¿‡å®ƒå¯ä»¥åŒºåˆ†ä¸åŒçš„actionï¼Œå…¶ç±»å‹åªèƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡æˆ–<code>Symbol</code>ã€‚<br/>
- payloadå±æ€§æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä½¿ä»»ä½•ç±»å‹ã€‚payloadå¯ä»¥ç”¨æ¥è£…è½½æ•°æ®ï¼›åœ¨errorä¸ºtrueçš„æ—¶å€™ï¼Œpayloadä¸€èˆ¬æ˜¯ç”¨æ¥è£…è½½é”™è¯¯ä¿¡æ¯ã€‚<br/>
- errorå±æ€§æ˜¯å¯é€‰çš„ï¼Œä¸€èˆ¬å½“å‡ºç°é”™è¯¯æ—¶å…¶å€¼ä¸ºtrueï¼›å¦‚æœæ˜¯å…¶ä»–å€¼ï¼Œä¸è¢«ç†è§£ä¸ºå‡ºç°é”™è¯¯ã€‚<br/>
- metaå±æ€§å¯ä»¥ä½¿ä»»ä½•ç±»å‹ï¼Œå®ƒä¸€èˆ¬ä¼šåŒ…æ‹¬ä¸€äº›ä¸é€‚åˆåœ¨payloadä¸­æ”¾ç½®çš„æ•°æ®ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè·å–goodsä¿¡æ¯çš„actionï¼š</p>

<pre><code class="language-javascript">// action/goods.js
const getGoods = goods =&gt; {
    return {
        type: &#39;GET_GOODS&#39;,
        payload: goods
    };
}
</code></pre>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°<code>GET_GOODS</code>è¿™ä¸ªactionã€‚</p>

<p>åœ¨é¡¹ç›®ä¸­ï¼Œä½¿ç”¨redux-actionså¯¹actionsè¿›è¡Œåˆ›å»ºä¸ç®¡ç†ï¼š</p>

<pre><code class="language-javascript">createAction(type, payloadCreator = Identity, ?metaCreator)
</code></pre>

<p><code>createAction</code>ç›¸å½“äºå¯¹actionåˆ›å»ºå™¨çš„ä¸€ä¸ªåŒ…è£…ï¼Œä¼šè¿”å›ä¸€ä¸ªFSAï¼Œä½¿ç”¨è¿™ä¸ªè¿”å›çš„FSAå¯ä»¥åˆ›å»ºå…·ä½“çš„actionã€‚</p>

<p><code>payloadCreator</code>æ˜¯ä¸€ä¸ª<code>function</code>ï¼Œå¤„ç†å¹¶è¿”å›éœ€è¦çš„payloadï¼›å¦‚æœç©ºç¼ºï¼Œä¼šä½¿ç”¨é»˜è®¤æ–¹æ³•ã€‚å¦‚æœä¼ å…¥ä¸€ä¸ª<code>Error</code>å¯¹è±¡åˆ™ä¼šè‡ªåŠ¨å°†actionçš„errorå±æ€§è®¾ä¸º<code>true</code>ï¼š</p>

<pre><code class="language-javascript">example = createAction(&#39;EXAMLE&#39;, data =&gt; data);
// å’Œä¸‹é¢çš„ä½¿ç”¨æ•ˆæœä¸€æ ·
example = createAction(&#39;EXAMLE&#39;);
</code></pre>

<p>å› æ­¤ä¸Šé¢çš„æ–¹å¼å¯ä»¥æ”¹å†™ä¸ºï¼š</p>

<pre><code class="language-javascript">// action/goods.js
import {createAction} from &#39;redux-actions&#39;;
export const getGoods = createAction(&#39;GET_GOODS&#39;); 
</code></pre>

<p>* æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>createActions</code>åŒæ—¶åˆ›å»ºå¤šä¸ªaction creatorsã€‚</p>

<h3 id="toc_7">å…¶æ¬¡ï¼Œåˆ›å»ºstateçš„å¤„ç†æ–¹æ³•â€”â€”reducer</h3>

<p>é’ˆå¯¹ä¸åŒçš„actionï¼Œä¼šæœ‰ä¸åŒçš„reducerå¯¹åº”è¿›è¡Œstateå¤„ç†ï¼Œå®ƒä»¬é€šè¿‡typeçš„å€¼ç›¸äº’å¯¹åº”ã€‚<br/>
reduceræ˜¯ä¸€ä¸ªå¤„ç†stateçš„æ–¹æ³•ï¼ˆfunctionï¼‰ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå½“å‰çŠ¶æ€<code>state</code>å’Œå¯¹åº”çš„<code>action</code>ã€‚æ ¹æ®<code>state</code>ä¸<code>action</code>ï¼Œreducerä¼šè¿›è¡Œå¤„ç†å¹¶è¿”å›ä¸€ä¸ªæ–°çš„<code>state</code>ï¼ˆåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ–°çš„<code>object</code>ï¼Œè€Œä¸å»ä¿®æ”¹åŸ<code>state</code>ï¼‰ã€‚å¯ä»¥é€šè¿‡ç®€å•çš„switchæ“ä½œæ¥å®ç°ï¼š</p>

<pre><code class="language-javascript">// reducer/goods.js
const goods = (state, action) =&gt; {
    switch (action.type) {
        case &#39;GET_GOODS&#39;:
            return {
                ...state,
                data: action.payload
            };
        // å…¶ä»–actionå¤„ç†â€¦â€¦
    }
}
</code></pre>

<p>å¯¹åº”<code>createAction</code>ï¼Œ<code>redux-actions</code>ä¹Ÿæœ‰ç›¸åº”çš„reduceræ–¹å¼ï¼š</p>

<pre><code class="language-javascript">handleAction(type, reducer | reducerMap = Identity, defaultState)
</code></pre>

<p><code>type</code>å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>createAction</code>è¿”å›çš„actionåˆ›å»ºå™¨ï¼š</p>

<pre><code class="language-javascript">handleAction(&#39;GET_GOODS&#39;, {
    next(state, action) {...},
    throw(state, action) {...}
}, defaultState);

//æˆ–è€…å¯ä»¥æ˜¯
handleAction(getGoods, {
    next(state, action) {...},
    throw(state, action) {...}
}, defaultState);
</code></pre>

<p>æ­¤å¤–ï¼Œæœ‰æ—¶å€™ä¸€äº›æ“ä½œçš„ä¸€ç³»åˆ—actionå¯ä»¥åœ¨è¯­ä¹‰å’Œä¸šåŠ¡é€»è¾‘ä¸Šæ˜¯æœ‰ä¸€å®šè”ç³»çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å°†ä»–ä»¬æ”¾åœ¨ä¸€èµ·ä¾¿äºç»´æŠ¤ã€‚å¯ä»¥é€šè¿‡<code>handleActions</code>æ–¹æ³•å°†å¤šä¸ªç›¸å…³çš„reducerå†™åœ¨ä¸€èµ·ï¼Œä»¥ä¾¿äºåæœŸç»´æŠ¤ï¼š</p>

<pre><code class="language-javascript">handleActions(reducerMap, defaultState)
</code></pre>

<p>å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>redux-actions</code>æ¥æ”¹å†™æˆ‘ä»¬ä¹‹å‰å†™çš„reducer</p>

<pre><code class="language-javascript">// reducer/goods.js
import {handleActions} from &#39;redux-actions&#39;;

export const goods = handleActions({
    GET_GOODS: (state, action) =&gt; ({
        ...state,
        data: action.payload
    })
}, {
    data: []
});
</code></pre>

<h3 id="toc_8">ç„¶åï¼Œå¯¹reducerè¿›è¡Œåˆå¹¶</h3>

<p>å› ä¸ºåœ¨reduxä¸­ä¼šç»Ÿä¸€ç®¡ç†ä¸€ä¸ªstoreï¼Œå› æ­¤ï¼Œéœ€è¦å°†ä¸ç”¨çš„reduceræ‰€å¤„ç†çš„stateè¿›è¡Œåˆå¹¶ã€‚</p>

<p>reduxä¸ºæˆ‘ä»¬æä¾›äº†<code>combineReducers</code>æ–¹æ³•ã€‚å½“ä¸šåŠ¡é€»è¾‘è¿‡å¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªreducerè¿›è¡Œç»„åˆï¼Œç”Ÿæˆä¸€ä¸ªç»Ÿä¸€çš„reducerã€‚è™½ç„¶ç°åœ¨æˆ‘ä»¬åªæœ‰ä¸€ä¸ªreducerï¼Œä½†æ˜¯ä¸ºäº†æ‹“å±•æ€§å’Œç¤ºèŒƒæ€§ï¼Œåœ¨è¿™é‡Œè¿˜æ˜¯åˆ›å»ºäº†ä¸€ä¸ª<code>reducer/index.js</code>æ–‡ä»¶æ¥è¿›è¡Œreducerçš„åˆå¹¶ï¼Œç”Ÿæˆä¸€ä¸ª<code>rootReducer</code>ã€‚</p>

<pre><code class="language-javascript">// reducer/index.js
import {combineReducers} from &#39;redux&#39;;
import {goods} from &#39;./goods&#39;;

export const rootReducer = combineReducers({
    goods
});
</code></pre>

<h3 id="toc_9">ä¹‹åï¼Œå°†é¡µé¢ç»„ä»¶ä¸æ•°æ®æµç›¸ç»“åˆ</h3>

<p>ä¸Šé¢çš„éƒ¨åˆ†å·²ç»å°†reduxä¸­çš„actionä¸reduceråˆ›å»ºå®Œæ¯•äº†ï¼Œç„¶è€Œï¼Œç°åœ¨çš„æ•°æ®æµå’Œæˆ‘ä»¬çš„ç»„ä»¶ä»ç„¶æ˜¯å¤„äºåˆ†ç¦»çŠ¶æ€çš„ï¼Œæˆ‘ä»¬éœ€è¦è®©å…¨å±€çš„<code>state</code>ï¼Œå³<code>store</code>ï¼Œçš„å˜åŒ–èƒ½å¤Ÿé©±åŠ¨é¡µé¢ç»„ä»¶çš„å˜åŒ–ï¼Œæ‰èƒ½å®Œæˆredux-flowä¸­çš„æœ€åä¸€ç¯ã€‚è¿™å°±éœ€è¦å°†<code>store</code>ä¸­çš„å„éƒ¨åˆ†<code>state</code>æ˜ å°„åˆ°ç»„ä»¶çš„<code>props</code>ä¸Šã€‚</p>

<p>è§£å†³è¿™ä¸ªé—®é¢˜å°±è¦ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰æåˆ°çš„<code>react-redux</code>å·¥å…·äº†ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åŸºäº<code>rootReducer</code>åˆ›å»ºä¸€ä¸ªå…¨å±€çš„<code>store</code>ã€‚åœ¨<code>src</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>store.js</code>æ–‡ä»¶ï¼Œè°ƒç”¨reduxçš„<code>createStore</code>æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">// store.js
import {createStore} from &#39;redux&#39;;
import {rootReducer} from &#39;./reducer&#39;;
export const store = createStore(rootReducer);
</code></pre>

<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦è®©æ‰€æœ‰çš„ç»„ä»¶éƒ½èƒ½è®¿é—®åˆ°<code>store</code>ã€‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨react-redux<br/>
æä¾›çš„<code>Provider</code>å¯¹æ•´ä¸ªåº”ç”¨è¿›è¡ŒåŒ…è£…ã€‚è¿™æ ·å°±å¯ä»¥ä½¿æ‰€æœ‰çš„å­é¡µé¢ã€å­ç»„ä»¶èƒ½è®¿é—®åˆ°<code>store</code>ã€‚å› æ­¤éœ€è¦æ”¹å†™<code>index.js</code>ï¼š</p>

<pre><code class="language-javascript">// index.js
import React from &#39;react&#39;;
import ReactDOM from &#39;react-dom&#39;;
import &#39;./index.css&#39;;
import App from &#39;./App&#39;;
import {Provider} from &#39;react-redux&#39;;
import {store} from &#39;./store&#39;;

ReactDOM.render(
    &lt;Provider store={store}&gt;
        &lt;App /&gt;
    &lt;/Provider&gt;,
document.getElementById(&#39;root&#39;));
</code></pre>

<p>æœ€åï¼Œæ‰æ˜¯è¿›è¡Œç»„ä»¶ä¸çŠ¶æ€çš„è¿æ¥ã€‚å°†storeä¸­éœ€è¦æ˜ å°„çš„éƒ¨åˆ†connectåˆ°æˆ‘ä»¬çš„ç»„ä»¶ä¸Šã€‚ä½¿ç”¨å…¶<code>connect</code>æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>

<pre><code class="language-javascript">connect(mapStateToProps)(component)ï¼›
</code></pre>

<p>reduxä¸­å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„storeï¼Œå…¶ä¸­å­˜å‚¨äº†æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ï¼Œå¯¹å…¶è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚<code>connect</code>å¯ä»¥å°†è¿™ä¸ªçŠ¶æ€ä¸­çš„æ•°æ®è¿æ¥åˆ°é¡µé¢ç»„ä»¶ä¸Šã€‚å…¶ä¸­ï¼Œ<code>mapStateToProps</code>æ˜¯storeä¸­çŠ¶æ€åˆ°è¯¥ç»„ä»¶å±æ€§çš„ä¸€ä¸ªæ˜ å°„æ–¹å¼ï¼Œ<code>component</code>æ˜¯éœ€è¦è¿æ¥çš„é¡µé¢ç»„ä»¶ã€‚é€šè¿‡<code>connect</code>æ–¹æ³•ï¼Œä¸€æ—¦storeå‘ç”Ÿå˜åŒ–ï¼Œç»„ä»¶ä¹Ÿå°±ä¼šç›¸åº”æ›´æ–°ã€‚</p>

<p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹åŸå…ˆ<code>page/goods.js</code></p>

<pre><code class="language-html">import React, { Component } from &#39;react&#39;;
import {connect} from &#39;react-redux&#39;;

class Goods extends Component {
    render() {
        return (
            &lt;ul className=&quot;goods&quot;&gt;
                {
                    this.props.list.map((ele, idx) =&gt; (
                        &lt;li key={idx} style={{marginBottom: 20, listStyle: &#39;none&#39;}}&gt;
                            &lt;span&gt;{ele.name}&lt;/span&gt; | 
                            &lt;span&gt;ï¿¥ {ele.price}&lt;/span&gt; | 
                            &lt;span&gt;å‰©ä½™ {ele.amount} ä»¶&lt;/span&gt;
                        &lt;/li&gt;
                    ))
                }
            &lt;/ul&gt;
        );
    }
}

const mapStateToProps = (state, ownProps) =&gt; ({
    goods: state.goods.data
});
// export default Goods;
export default connect(mapStateToProps)(Goods);
</code></pre>

<p>æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä¸ºç»„ä»¶ä¸­ç›¸åº”çš„æ–¹æ³•æ˜ å°„å¯¹åº”çš„actionçš„è§¦å‘ï¼š</p>

<pre><code class="language-javascript">const mapDispatchToProps = dispatch =&gt; ({
    onShownClick: () =&gt; dispatch($yourAction)
});
</code></pre>

<h3 id="toc_10">æœ€åï¼Œåœ¨ç»„ä»¶æ¸²æŸ“å®Œæˆåè§¦å‘æ•´ä¸ªflow</h3>

<p>å¦‚æœäº§ç”Ÿäº†ä¸€ä¸ªéœ€è¦çŠ¶æ€æ›´æ–°çš„äº¤äº’ï¼Œå¯ä»¥é€šè¿‡åœ¨ç»„ä»¶ä¸­ç›¸åº”éƒ¨åˆ†è§¦å‘actionæ¥å®ç°çŠ¶æ€æ›´æ–°--&gt;ç»„ä»¶æ›´æ–°ã€‚è§¦å‘æ–¹å¼ï¼š</p>

<pre><code class="language-javascript">dispatch($your_action)
</code></pre>

<p><code>connect</code>åçš„ç»„ä»¶ï¼Œå…¶<code>props</code>é‡Œä¼šæœ‰ä¸€ä¸ª<code>dispatch</code>çš„å±æ€§ï¼Œå°±æ˜¯ä¸ª<code>dispatch</code>æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">let dispatch = this.props.dispatch;
</code></pre>

<p>å› æ­¤ï¼Œæœ€ç»ˆçš„<code>page/goods.js</code>ç»„ä»¶å¦‚ä¸‹ï¼š</p>

<pre><code>import React, { Component } from &#39;react&#39;;
import {connect} from &#39;react-redux&#39;;
import * as actions from &#39;../action/goods&#39;;

const GOODS = [{
    name: &#39;iPhone 7&#39;,
    price: &#39;6,888&#39;,
    amount: 37
}, {
    name: &#39;iPad&#39;,
    price: &#39;3,488&#39;,
    amount: 82
}, {
    name: &#39;MacBook Pro&#39;,
    price: &#39;11,888&#39;,
    amount: 15
}]; 

class Goods extends Component {
    componentDidMount() {
        let dispatch = this.props.dispatch;
        dispatch(actions.getGoods(GOODS));
    }
    render() {
        return (
            &lt;ul className=&quot;goods&quot;&gt;
                {
                    this.props.goods.map((ele, idx) =&gt; (
                        &lt;li key={idx} style={{marginBottom: 20, listStyle: &#39;none&#39;}}&gt;
                            &lt;span&gt;{ele.name}&lt;/span&gt; | 
                            &lt;span&gt;ï¿¥ {ele.price}&lt;/span&gt; | 
                            &lt;span&gt;å‰©ä½™ {ele.amount} ä»¶&lt;/span&gt;
                        &lt;/li&gt;
                    ))
                }
            &lt;/ul&gt;
        );
    }
}

const mapStateToProps = (state, ownProps) =&gt; ({
    goods: state.goods.data
});

export default connect(mapStateToProps)(Goods);
</code></pre>

<p>æ³¨æ„åˆ°ï¼Œç»„ä»¶ä¸­æ•°æ®ä¸å†æ˜¯ç”±<code>App.js</code>ä¸­å†™å…¥çš„äº†ï¼Œè€Œæ˜¯ç»è¿‡äº†å®Œæ•´çš„redux-flowçš„è¿‡ç¨‹è·å–å¹¶æ¸²æŸ“çš„ã€‚æ³¨æ„åŒæ—¶ä¿®æ”¹<code>App.js</code></p>

<pre><code class="language-javascript">import React, { Component } from &#39;react&#39;;
import Nav from &#39;./component/nav&#39;;
import Welcome from &#39;./page/welcome&#39;;
import Goods from &#39;./page/goods&#39;;
import &#39;./App.css&#39;;

const LIST = [{
    text: &#39;welcome&#39;,
    url: &#39;/&#39;
}, {
    text: &#39;goods&#39;,
    url: &#39;/goods&#39;
}];

class App extends Component {
    render() {
        return (
            &lt;div className=&quot;App&quot;&gt;
                &lt;div className=&quot;nav_bar&quot;&gt;
                    &lt;Nav list={LIST} /&gt;
                &lt;/div&gt;
                &lt;div className=&quot;conent&quot;&gt;
                    &lt;Welcome /&gt;
                    &lt;Goods /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }
}

export default App;
</code></pre>

<p>ç°åœ¨è®¿é—®é¡µé¢ï¼Œè™½ç„¶æ•ˆæœå’Œä¹‹å‰ä¸€è‡´ï¼Œä½†æ˜¯å…¶å†…éƒ¨æ„é€ å’ŒåŸç†å·²ç»å¤§ä¸ç›¸åŒäº†ã€‚</p>

<h2 id="toc_11">æœ€åä¸€éƒ¨åˆ†ï¼šæ·»åŠ è·¯ç”±ç³»ç»Ÿ</h2>

<p>å•é¡µåº”ç”¨ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œå°±æ˜¯è·¯ç”±ç³»ç»Ÿã€‚ç”±äºä¸åŒæ™®é€šçš„é¡µé¢è·³è½¬åˆ·æ–°ï¼Œå› æ­¤å•é¡µåº”ç”¨ä¼šæœ‰ä¸€å¥—è‡ªå·±çš„è·¯ç”±ç³»ç»Ÿéœ€è¦ç»´æŠ¤ã€‚</p>

<p>æˆ‘ä»¬å½“ç„¶å¯ä»¥æ‰‹å†™ä¸€ä¸ªè·¯ç”±ç³»ç»Ÿï¼Œä½†æ˜¯ï¼Œä¸ºäº†å¿«é€Ÿæœ‰æ•ˆåœ°åˆ›å»ºäºç®¡ç†æˆ‘ä»¬çš„åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªå¥½ç”¨çš„è·¯ç”±ç³»ç»Ÿã€‚æœ¬æ–‡é€‰æ‹©äº†react-router 4ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåœ¨v4ç‰ˆæœ¬é‡Œï¼Œreact-routerå°†WEBéƒ¨åˆ†çš„è·¯ç”±ç³»ç»Ÿæ‹†åˆ†è‡³äº†<code>react-router-dom</code>ï¼Œå› æ­¤éœ€è¦npm<code>react-router-dom</code></p>

<pre><code class="language-bash">npm i --save react-router-dom
</code></pre>

<p>æœ¬ä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨react-routerä¸­çš„<code>BrowserRouter</code>ç»„ä»¶åŒ…è£¹æ•´ä¸ªAppåº”ç”¨ï¼Œåœ¨å…¶ä¸­ä½¿ç”¨<code>Route</code>ç»„ä»¶ç”¨äºåŒ¹é…ä¸åŒçš„è·¯ç”±æ—¶åŠ è½½ä¸åŒçš„é¡µé¢ç»„ä»¶ã€‚ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨<code>HashRouter</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ä½¿ç”¨hashæ¥ä½œä¸ºè·¯å¾„ï¼‰react-routeræ¨èä½¿ç”¨<code>BrowserRouter</code>ï¼Œ<code>BrowserRouter</code>éœ€è¦<code>history</code>ç›¸å…³çš„APIæ”¯æŒã€‚</p>

<p>é¦–å…ˆï¼Œéœ€è¦åœ¨<code>App.js</code>ä¸­æ·»åŠ <code>BrowserRouter</code>ç»„ä»¶ï¼Œå¹¶å°†<code>Route</code>ç»„ä»¶æ”¾åœ¨<code>BrowserRouter</code>å†…ã€‚å…¶ä¸­<code>Route</code>ç»„ä»¶æ¥æ”¶ä¸¤ä¸ªå±æ€§ï¼š<code>path</code>å’Œ<code>component</code>ï¼Œåˆ†åˆ«æ˜¯åŒ¹é…çš„è·¯å¾„ä¸åŠ è½½æ¸²æŸ“çš„ç»„ä»¶</p>

<pre><code class="language-javascript">// index.js
import React from &#39;react&#39;;
import ReactDOM from &#39;react-dom&#39;;
import &#39;./index.css&#39;;
import App from &#39;./App&#39;;
import {Provider} from &#39;react-redux&#39;;
import {store} from &#39;./store&#39;;
import {BrowserRouter, Route} from &#39;react-router-dom&#39;;

ReactDOM.render(
    &lt;Provider store={store}&gt;
        &lt;BrowserRouter&gt;
            &lt;Route path=&#39;/&#39; component={App}/&gt;
        &lt;/BrowserRouter&gt;
    &lt;/Provider&gt;,
document.getElementById(&#39;root&#39;));
</code></pre>

<p>æ­¤æ—¶æˆ‘ä»¬å¯åŠ¨æœåŠ¡å™¨çš„æ•ˆæœå’Œä¹‹å‰ä¸€ç›´ã€‚å› ä¸ºæ­¤æ—¶è·¯ç”±åŒ¹é…åˆ°äº†<code>path=&#39;/&#39;</code>ï¼Œå› æ­¤åŠ è½½äº†<code>App</code>ç»„ä»¶ã€‚</p>

<p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨æœ€å¼€å§‹éƒ¨åˆ†åˆ›å»ºçš„<code>Nav</code>å¯¼èˆªæ ç»„ä»¶ä¹ˆï¼Ÿç°åœ¨ï¼Œæˆ‘ä»¬å°±è¦å®ç°å¯¼èˆªåŠŸèƒ½ï¼šç‚¹å‡»å¯¹åº”çš„å¯¼èˆªæ é“¾æ¥ï¼Œå³ä¾§æ˜¾ç¤ºä¸åŒçš„åŒºåŸŸå†…å®¹ã€‚è¿™éœ€è¦æ”¹é€ <code>index.js</code>ä¸­çš„contentéƒ¨åˆ†ï¼šæˆ‘ä»¬ä¸ºå…¶æ·»åŠ ä¸¤ä¸ª<code>Route</code>ç»„ä»¶ï¼Œåˆ†åˆ«åœ¨ä¸åŒçš„è·¯å¾„ä¸‹åŠ è½½ä¸åŒçš„é¡µé¢ç»„ä»¶ï¼ˆ<code>welcome</code>ä¸<code>goods</code>ï¼‰</p>

<pre><code class="language-javascript">// App.js
import React, { Component } from &#39;react&#39;;
import Nav from &#39;./component/nav&#39;;
import Welcome from &#39;./page/welcome&#39;;
import Goods from &#39;./page/goods&#39;;
import &#39;./App.css&#39;;
import {Route} from &#39;react-router-dom&#39;;

const LIST = [{
    text: &#39;welcome&#39;,
    url: &#39;/welcome&#39;
}, {
    text: &#39;goods&#39;,
    url: &#39;/goods&#39;
}];

class App extends Component {
    render() {
        return (
            &lt;div className=&quot;App&quot;&gt;
                &lt;div className=&quot;nav_bar&quot;&gt;
                    &lt;Nav list={LIST} /&gt;
                &lt;/div&gt;
                &lt;div className=&quot;conent&quot;&gt;
                    &lt;Route path=&#39;/welcome&#39; component={Welcome} /&gt;
                    &lt;Route path=&#39;/goods&#39; component={Goods} /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }
}

export default App;
</code></pre>

<p>ç°åœ¨ï¼Œå¯ä»¥å°è¯•åœ¨åœ°å€æ è¾“å…¥<code>http://localhost:3000</code>ã€<code>http://localhost:3000/welcome</code>å’Œ<code>http://localhost:3000/goods</code>æ¥æŸ¥çœ‹æ•ˆæœã€‚</p>

<p>å½“ç„¶ï¼Œå®é™…é¡¹ç›®é‡Œä¸å¯èƒ½æ˜¯é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹åœ°å€æ æ¥â€œè·³è½¬â€é¡µé¢ã€‚æ‰€ä»¥éœ€è¦ç”¨åˆ°<code>Link</code>è¿™ä¸ªç»„ä»¶ã€‚é€šè¿‡å…¶ä¸­çš„<code>to</code>è¿™ä¸ªå±æ€§æ¥æŒ‡æ˜â€œè·³è½¬â€çš„åœ°å€ã€‚è¿™ä¸ª<code>Link</code>ç»„ä»¶æˆ‘ä»¬ä¼šæ·»åŠ åˆ°<code>Nav</code>ç»„ä»¶ä¸­</p>

<pre><code>// component/nav/index.js
import React from &#39;react&#39;;
import &#39;./index.css&#39;;
import {Link} from &#39;react-router-dom&#39;;

const Nav = props =&gt; (
    &lt;ul className=&quot;nav&quot;&gt;
        {
            props.list.map((ele, idx) =&gt; (
                &lt;Link to={ele.url} key={idx}&gt;
                    &lt;li&gt;{ele.text}&lt;/li&gt;
                &lt;/Link&gt;
            ))
        }
    &lt;/ul&gt;
);

export default Nav;
</code></pre>

<p>æœ€ç»ˆé¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-2a910fb0b5ca7659.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ€ç»ˆæ•ˆæœå›¾welcomeé¡µé¢"/></p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-c1e748c23f8d83cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ€ç»ˆæ•ˆæœå›¾goodsé¡µé¢"/></p>

<p>ç°åœ¨åœ¨è¿™ä¸ªdemoé‡Œï¼Œæˆ‘ä»¬ç‚¹å‡»å·¦ä¾§çš„å¯¼èˆªï¼Œå³ä¾§å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œæµè§ˆå™¨ä¸ä¼šåˆ·æ–°ã€‚åŸºäºReact+Redux+React-routerï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæœ€åŸºç¡€ç‰ˆçš„SPAï¼ˆå•é¡µåº”ç”¨ï¼‰ã€‚</p>

<hr/>

<p><strong><a href="https://github.com/alienzhou/react-redux-demo">ç‚¹å‡»è¿™é‡Œå¯ä»¥ä¸‹è½½è¿™ä¸ªdemoã€‚</a></strong></p>

<hr/>

<h2 id="toc_12">é¢å¤–çš„éƒ¨åˆ†ï¼Œå¼‚æ­¥è¯·æ±‚</h2>

<p>å¦‚æœä½ è¿˜è®°å¾—åœ¨reduxæ•°æ®æµéƒ¨åˆ†ï¼Œæ˜¯æ€ä¹ˆç»™goodsé¡µé¢ä¼ å…¥æ•°æ®çš„ï¼š<code>dispatch(actions.getGoods(GOODS))</code>ï¼Œæˆ‘ä»¬ç›´æ¥ç»™<code>getGoods</code>è¿™ä¸ª<code>action</code>æ„é€ å™¨ä¼ å…¥<code>GOODS</code>åˆ—è¡¨ï¼Œä½œä¸ºåŠ è½½çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå¾€å¾€ï¼Œæˆ‘ä»¬ä¼šåœ¨actionä¸­å‘é€ajaxè¯·æ±‚ï¼Œä»åç«¯è·å–æ•°æ®ï¼›åœ¨ç­‰å¾…æ•°æ®è·å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½è¿˜ä¼šæœ‰ä¸€ä¸ªloadingæ•ˆæœï¼›æœ€åæ”¶åˆ°äº†responseå“åº”ï¼Œå†æ¸²æŸ“å“åº”é¡µé¢ã€‚</p>

<p>åŸºäºä»¥ä¸Šçš„åœºæ™¯ï¼Œé‡æ–°æ•´ç†ä¸€ä¸‹æˆ‘ä»¬çš„actionå†…çš„æ€è·¯ï¼š</p>

<ol>
<li>componentæ¸²æŸ“å®Œæˆåï¼Œè§¦å‘ä¸€ä¸ªactionï¼Œ<code>dispatch(actions.getGoods())</code>ã€‚è¿™ä¸ªactionå¹¶ä¸ä¼šå¸¦åˆ—è¡¨çš„å‚æ•°ï¼Œè€Œæ˜¯å‘åç«¯è¯·æ±‚ç»“æœã€‚</li>
<li>åœ¨<code>getGoods()</code>è¿™ä¸ªæ–¹æ³•é‡Œï¼Œä¸»è¦ä¼šåšè¿™ä¸‰ä»¶æ•°ï¼šé¦–å…ˆï¼Œè§¦å‘ä¸€ä¸ª<code>requestGoods</code>çš„actionï¼Œç”¨äºè¡¨ç¤ºç°åœ¨æ­£åœ¨è¯·æ±‚æ•°æ®ï¼›å…¶æ¬¡ï¼Œä¼šè°ƒç”¨ä¸€ä¸ªå«<code>fetchData()</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªå°±æ˜¯å‘åç«¯è¯·æ±‚æ•°æ®çš„æ–¹æ³•ï¼›æœ€åï¼Œåœ¨æ‹¿åˆ°æ•°æ®åï¼Œå†è§¦å‘ä¸€ä¸ª<code>receiveGoods</code>çš„actionï¼Œç”¨äºæ ‡è¯†è¯·æ±‚å®Œæˆå¹¶å¸¦ä¸Šæ¸²æŸ“çš„æ•°æ®ã€‚</li>
<li>å…¶ä»–éƒ¨åˆ†ä¸ä¹‹å‰ç±»ä¼¼ã€‚</li>
</ol>

<p>è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºäºä¸Šé¢çš„è®¨è®ºï¼Œæˆ‘ä»¬éœ€è¦<code>actions.getGoods()</code>è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª<code>function</code>æ¥å®ç°æˆ‘ä»¬åœ¨æ­¥éª¤2é‡Œæ‰€è¯´çš„ä¸‰ä¸ªåŠŸèƒ½ï¼›ç„¶è€Œï¼Œç›®å‰é¡¹ç›®ä¸­çš„<code>dispatch()</code>æ–¹æ³•åªèƒ½æ¥å—ä¸€ä¸ª<code>object</code>ç±»å‹ä½œä¸ºå‚æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æ”¹é€ <code>dispatch()</code>æ–¹æ³•ã€‚</p>

<p>æ”¹é€ çš„æ‰‹æ®µå°±æ˜¯ä½¿ç”¨redux-thunkè¿™ä¸ªä¸­é—´ä»¶ã€‚å¯ä»¥ä½¿action creatorè¿”å›ä¸€ä¸ª<code>function</code>ï¼ˆè€Œä¸ä»…ä»…æ˜¯<code>object</code>ï¼‰ï¼Œå¹¶ä¸”ä½¿å¾—dispatchæ–¹æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ª<code>function</code>ä½œä¸ºå‚æ•°ï¼Œé€šè¿‡è¿™ç§æ”¹é€ ä½¿å¾—actionæ”¯æŒå¼‚æ­¥ï¼ˆæˆ–å»¶è¿Ÿï¼‰æ“ä½œã€‚</p>

<p>é‚£ä¹ˆå¦‚ä½•æ¥æ”¹é€ å‘¢ï¼Ÿé¦–å…ˆä¸ºreduxåŠ å…¥redux-thunkè¿™ä¸ªä¸­é—´ä»¶</p>

<pre><code class="language-bash">npm i --save redux-thunk
</code></pre>

<p>ç„¶åä¿®æ”¹<code>store.js</code></p>

<pre><code class="language-javascript">// store.js
import {createStore, applyMiddleware, compose} from &#39;redux&#39;;
import {rootReducer} from &#39;./reducer&#39;;
import thunk from &#39;redux-thunk&#39;;

const middleware = [thunk];
export const store = createStore(rootReducer, compose(
    applyMiddleware(...middleware)
));
</code></pre>

<p>ç„¶åï¼ŒåŸºäºä¹‹å‰çš„æ€è·¯ï¼Œæ•´ç†actionä¸­çš„ä»£ç ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨setTimeoutæ¥æ¨¡æ‹Ÿå‘åç«¯è¯·æ±‚æ•°æ®ï¼š</p>

<pre><code class="language-javascript">// action/goods.js
import {createAction} from &#39;redux-actions&#39;;

const GOODS = [{
    name: &#39;iPhone 7&#39;,
    price: &#39;6,888&#39;,
    amount: 37
}, {
    name: &#39;iPad&#39;,
    price: &#39;3,488&#39;,
    amount: 82
}, {
    name: &#39;MacBook Pro&#39;,
    price: &#39;11,888&#39;,
    amount: 15
}]; 

const requestGoods = createAction(&#39;REQUEST_GOODS&#39;);
const receiveGoods = createAction(&#39;RECEIVE_GOODS&#39;);

const fetchData = () =&gt; {
    return new Promise((resolve, reject) =&gt; {
        setTimeout(() =&gt; {
            resolve(GOODS);
        }, 1500);
    });
};

export const getGoods = () =&gt; async dispatch =&gt; {
    dispatch(requestGoods());
    let goods = await fetchData();
    dispatch(receiveGoods(goods));
};
</code></pre>

<p>ç›¸åº”åœ°ä¿®æ”¹reducerä¸­çš„ä»£ç </p>

<pre><code class="language-javascript">// reducer/goods.js
import {handleActions} from &#39;redux-actions&#39;;

export const goods = handleActions({
    REQUEST_GOODS: (state, action) =&gt; ({
        ...state,
        isFetching: true
    }),
    RECEIVE_GOODS: (state, action) =&gt; ({
        ...state,
        isFetching: false,
        data: action.payload
    })
}, {
    isFetching: false,
    data: []
});
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª<code>isFetching</code>çš„çŠ¶æ€æ¥è¡¨ç¤ºæ•°æ®æ˜¯å¦åŠ è½½å®Œæ¯•ã€‚</p>

<p>æœ€åï¼Œè¿˜éœ€è¦æ›´æ–°UI componentå±‚</p>

<pre><code>// page/goods.js
import React, { Component } from &#39;react&#39;;
import {connect} from &#39;react-redux&#39;;
import * as actions from &#39;../action/goods&#39;;

class Goods extends Component {
    componentDidMount() {
        let dispatch = this.props.dispatch;
        dispatch(actions.getGoods());
    }
    render() {
        return this.props.isFetching ? (&lt;h1&gt;Loadingâ€¦&lt;/h1&gt;) : (
            &lt;ul className=&quot;goods&quot;&gt;
                {
                    this.props.goods.map((ele, idx) =&gt; (
                        &lt;li key={idx} style={{marginBottom: 20, listStyle: &#39;none&#39;}}&gt;
                            &lt;span&gt;{ele.name}&lt;/span&gt; | 
                            &lt;span&gt;ï¿¥ {ele.price}&lt;/span&gt; | 
                            &lt;span&gt;å‰©ä½™ {ele.amount} ä»¶&lt;/span&gt;
                        &lt;/li&gt;
                    ))
                }
            &lt;/ul&gt;
        );
    }
}

const mapStateToProps = (state, ownProps) =&gt; ({
    isFetching: state.goods.isFetching,
    goods: state.goods.data
});

export default connect(mapStateToProps)(Goods);
</code></pre>

<p>æœ€ç»ˆï¼Œè®¿é—®<code>http://localhost:3000/goods</code>é¡µé¢ä¼šæœ‰ä¸€ä¸ªå¤§çº¦1.5sçš„loadingæ•ˆæœï¼Œç„¶åç­‰â€œåç«¯â€æ•°æ®è¿”å›åæ¸²æŸ“å‡ºåˆ—è¡¨ã€‚</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-31f02cf83192276e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="loadingæ•ˆæœ"/></p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-c63f5cdf69659c53.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ—è¡¨åŠ è½½å®Œæ¯•"/></p>

<h2 id="toc_13">æœ€åçš„æœ€åï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰èµ°å¼€</h2>

<p>å†ä»‹ç»ä¸€ä¸ªreduxè°ƒè¯•ç¥å™¨â€”â€”<a href="https://github.com/gaearon/redux-devtools">redux-devTools</a>ï¼Œå¯ä»¥åœ¨chromeæ’ä»¶ä¸­å¯ä»¥æ‰¾åˆ°</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-2dd97c02d08631d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="redux-devTools extension"/></p>

<p>åœ¨å¼€å‘è€…å·¥å…·ä¸­ä½¿ç”¨ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œreduxçš„è°ƒè¯•</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-a19220d421015fe2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="redux-devToolsè°ƒè¯•ç•Œé¢"/></p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-2dc20497ac24afce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="redux-devToolsè°ƒè¯•ç•Œé¢"/></p>

<p>å½“ç„¶ï¼Œéœ€è¦åœ¨ä»£ç ä¸­è¿›è¡Œç®€å•çš„é…ç½®ã€‚å¯¹<code>store.js</code>è¿›è¡Œä¸€äº›å°ä¿®æ”¹</p>

<pre><code class="language-javascript">import {createStore, applyMiddleware, compose} from &#39;redux&#39;;
import {rootReducer} from &#39;./reducer&#39;;
import thunk from &#39;redux-thunk&#39;;

const middleware = [thunk];
// export const store = createStore(rootReducer, compose(
//     applyMiddleware(...middleware)
// ));
const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;
export const store = createStore(rootReducer, composeEnhancers(
    applyMiddleware(...middleware)
));
</code></pre>

<p>ä»¥ä¸Šã€‚</p>

<p>ç°åœ¨ï¼Œä½ å¯ä»¥æ„‰å¿«åœ°è¿›è¡ŒSPAçš„å¼€å‘å•¦ï¼<strong><a href="https://github.com/alienzhou/react-redux-demo">æœ¬æ–‡ä¸­çš„demoå¯ä»¥ç‚¹å‡»è¿™é‡Œè·å–</a></strong>ã€‚</p>

<hr/>

<h2 id="toc_14">Happy Codingï¼</h2>

<hr/>


		</div>
	

 
	

  
  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
