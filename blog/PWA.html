<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  PWA - AlienZHOU's blog
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="AlienZHOU's blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">AlienZHOU's blog</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; AlienZHOU's blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>PWA</label></li>

          
            <li><a title="【PWA学习与实践】(4) 解决FireBase login验证失败问题" href="15235166926023.html">【PWA学习与实践】(4) 解决FireBase login验证失败问题</a></li>
          
            <li><a title="【PWA学习与实践】(3) 让你的WebApp离线可用" href="15235151669706.html">【PWA学习与实践】(3) 让你的WebApp离线可用</a></li>
          
            <li><a title="【PWA学习与实践】(1) 2018，开始你的PWA学习之旅" href="15235138633619.html">【PWA学习与实践】(1) 2018，开始你的PWA学习之旅</a></li>
          
            <li><a title="【PWA学习与实践】(2) 使用Manifest，让你的WebApp更“Native”" href="15235140795593.html">【PWA学习与实践】(2) 使用Manifest，让你的WebApp更“Native”</a></li>
          

      
        <li class="divider"></li>
        <li><label>React</label></li>

          
            <li><a title="基于react技术栈的单页应用(SPA)搭建_快速入门实践" href="15236392559880.html">基于react技术栈的单页应用(SPA)搭建_快速入门实践</a></li>
          
            <li><a title="在react-router4中进行代码拆分（基于webpack）" href="15235187668595.html">在react-router4中进行代码拆分（基于webpack）</a></li>
          

      
        <li class="divider"></li>
        <li><label>CSS</label></li>

          
            <li><a title="【CSS模块化】(3) 使用💅styled-components来优化react组件开发" href="15236398426783.html">【CSS模块化】(3) 使用💅styled-components来优化react组件开发</a></li>
          
            <li><a title="【CSS模块化】(2) BEM命名方法论——使用BEM-constructor构建CSS" href="15236396803035.html">【CSS模块化】(2) BEM命名方法论——使用BEM-constructor构建CSS</a></li>
          
            <li><a title="【CSS模块化】(1) webpack之Local Scope" href="15236395841604.html">【CSS模块化】(1) webpack之Local Scope</a></li>
          

      
        <li class="divider"></li>
        <li><label>Server</label></li>

          
            <li><a title="【MongoDB高可用】复制集Replica Set使用简介" href="15236400113573.html">【MongoDB高可用】复制集Replica Set使用简介</a></li>
          

      
        <li class="divider"></li>
        <li><label>Automation</label></li>

          
            <li><a title="Gulp.js实践详解__基于Gulp的多页面应用实践指南" href="15236401468681.html">Gulp.js实践详解__基于Gulp的多页面应用实践指南</a></li>
          

      
        <li class="divider"></li>
        <li><label>FE else</label></li>

          
            <li><a title="浏览器同源策略与ajax跨域方法汇总" href="15236404711802.html">浏览器同源策略与ajax跨域方法汇总</a></li>
          
            <li><a title="JavaScript异步编程__“回调地狱”的一些解决方案" href="15236403350295.html">JavaScript异步编程__“回调地狱”的一些解决方案</a></li>
          
            <li><a title="js控制input框内光标位置（setSelectionRange详解）" href="15236405992551.html">js控制input框内光标位置（setSelectionRange详解）</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>PWA</span></li>
                        
                          <li><a title="【PWA学习与实践】(4) 解决FireBase login验证失败问题" href="15235166926023.html">【PWA学习与实践】(4) 解决FireBase login验证失败问题</a></li>
                        
                          <li><a title="【PWA学习与实践】(3) 让你的WebApp离线可用" href="15235151669706.html">【PWA学习与实践】(3) 让你的WebApp离线可用</a></li>
                        
                          <li><a title="【PWA学习与实践】(1) 2018，开始你的PWA学习之旅" href="15235138633619.html">【PWA学习与实践】(1) 2018，开始你的PWA学习之旅</a></li>
                        
                          <li><a title="【PWA学习与实践】(2) 使用Manifest，让你的WebApp更“Native”" href="15235140795593.html">【PWA学习与实践】(2) 使用Manifest，让你的WebApp更“Native”</a></li>
                        

                    
                      <li class="side-title"><span>React</span></li>
                        
                          <li><a title="基于react技术栈的单页应用(SPA)搭建_快速入门实践" href="15236392559880.html">基于react技术栈的单页应用(SPA)搭建_快速入门实践</a></li>
                        
                          <li><a title="在react-router4中进行代码拆分（基于webpack）" href="15235187668595.html">在react-router4中进行代码拆分（基于webpack）</a></li>
                        

                    
                      <li class="side-title"><span>CSS</span></li>
                        
                          <li><a title="【CSS模块化】(3) 使用💅styled-components来优化react组件开发" href="15236398426783.html">【CSS模块化】(3) 使用💅styled-components来优化react组件开发</a></li>
                        
                          <li><a title="【CSS模块化】(2) BEM命名方法论——使用BEM-constructor构建CSS" href="15236396803035.html">【CSS模块化】(2) BEM命名方法论——使用BEM-constructor构建CSS</a></li>
                        
                          <li><a title="【CSS模块化】(1) webpack之Local Scope" href="15236395841604.html">【CSS模块化】(1) webpack之Local Scope</a></li>
                        

                    
                      <li class="side-title"><span>Server</span></li>
                        
                          <li><a title="【MongoDB高可用】复制集Replica Set使用简介" href="15236400113573.html">【MongoDB高可用】复制集Replica Set使用简介</a></li>
                        

                    
                      <li class="side-title"><span>Automation</span></li>
                        
                          <li><a title="Gulp.js实践详解__基于Gulp的多页面应用实践指南" href="15236401468681.html">Gulp.js实践详解__基于Gulp的多页面应用实践指南</a></li>
                        

                    
                      <li class="side-title"><span>FE else</span></li>
                        
                          <li><a title="浏览器同源策略与ajax跨域方法汇总" href="15236404711802.html">浏览器同源策略与ajax跨域方法汇总</a></li>
                        
                          <li><a title="JavaScript异步编程__“回调地狱”的一些解决方案" href="15236403350295.html">JavaScript异步编程__“回调地狱”的一些解决方案</a></li>
                        
                          <li><a title="js控制input框内光标位置（setSelectionRange详解）" href="15236405992551.html">js控制input框内光标位置（setSelectionRange详解）</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 


	
		<div class="markdown-body">
		<h1>【PWA学习与实践】(4) 解决FireBase login验证失败问题</h1>

		<p>本文是《PWA学习与实践》系列的第四篇。是我在测试其他demo时遇到的一个问题，算是一篇TroubleShooting。</p>

<p><img src="media/15235166926023/15235167217543.jpg" alt=""/></p>

<p>PWA作为今年最火热的技术概念之一，对提升Web应用的安全、性能和体验有着很大的意义，非常值得我们去了解与学习。</p>

<p>本系列文章《PWA学习与实践》会逐步拆解PWA背后的各项技术，通过实例代码来讲解这些技术的应用方式。也正是因为PWA中技术点众多、知识细碎，因此我在学习过程中，进行了整理，并产出了《PWA学习与实践》系列文章，希望能带大家全面了解PWA中的各项技术。对PWA感兴趣的朋友欢迎关注。</p>

<h2 id="toc_0">引言</h2>

<p>在前一篇文章《让你的WebApp离线可用》中，我们使用Service Worker来做缓存与离线支持。是有一个重要的问题：<strong>Service Worker必须要在HTTPS协议下才能运行（或者localhost）</strong>。当然，对于一些只有前端资源（不涉及后端服务）的demo，我们完全可以将这些前端（静态资源）托管在一个HTTPS服务下，使得Service Worker可以使用。我选择了google的<a href="https://firebase.google.com/">FireBase</a>来托管demo（其实github page也是个不错的选择）。</p>

<p>使用FireBase非常简单，只需要<code>firebase login</code> --&gt;<code>firebase init</code>--&gt;<code>firebase deploy</code>即可。但是在<code>firebase login</code>的过程中，遇到了一些问题。这篇文章主要总结了我在<code>firebase login</code>遇到的问题及解决方式：<br/>
1. 无法获取authorization code<br/>
2. <code>Authentication Error: Your credentials are no longer valid.</code></p>

<p>有需要的朋友可以继续看。</p>

<p>首先，如果你对firebase完全不了解，下面会有一段非常简短的介绍。</p>

<h2 id="toc_1">什么是FireBase</h2>

<p>前段时间学习PWA，在跟着官方教程完成demo后，想要在手机上测试一下效果。然而，遇到的一个问题就是：PWA需要HTTPS协议（或者使用localhost）。</p>

<p>这就需要我们有一个HTTPS的服务，并在其上面部署我们本地写好的demo。而官方demo的最后，推荐使用firebase来托管你的代码。</p>

<p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162afdd08f75977a?w=700&amp;h=394&amp;f=png&amp;s=66460" alt="FireBase的各种功能与服务"/></p>

<p>在FireBase的众多使用场景中，Develop -&gt; Hosting（托管）就是我需要用到的了。然而，在执行<code>firebase login</code>（账号登录）过程中，却遇到了一些问题。</p>

<h2 id="toc_2">问题一：在浏览器登录账号后，无反应（无法获取authorization code）</h2>

<p>最开始，我在CLI中输入<code>firebase login</code>，选择<code>y</code>后，CLI会需要一个authorization code；而浏览器会打开并提示你进行登录。</p>

<p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162afdd08f8a3d0a?w=1171&amp;h=158&amp;f=png&amp;s=26957" alt=""/></p>

<p>这里我用google账户进行授权登录。然而，在授权之后，却迟迟没有响应（无法得到authorization code）。这时候，我发现浏览器显示，似乎是在等待<code>localhost</code>进行响应。</p>

<p>解决这个问题的方法就是：在登录时，使用<code>firebase login --no-localhost</code>进行登录。</p>

<p>重新使用<code>firebase login --no-localhost</code>登录。这里我选择了google账号进行登录，重复上面的过程：</p>

<p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162afdd08f8a3d0a?w=1171&amp;h=158&amp;f=png&amp;s=26957" alt=""/></p>

<p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162afdd08f994938?w=508&amp;h=563&amp;f=png&amp;s=28870" alt=""/></p>

<p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162afdd08f6cd205?w=484&amp;h=685&amp;f=png&amp;s=83614" alt=""/></p>

<p>这次，你就会在浏览器中获得一串authorization code值：</p>

<p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162afdd08f8759e8?w=1240&amp;h=178&amp;f=png&amp;s=16044" alt="authorization code"/></p>

<p>将它粘贴到CLI中即可。【问题一】解决！</p>

<h2 id="toc_3">问题二：Error: Authentication Error: Your credentials are no longer valid.</h2>

<p>然而，在CLI中输入authorization code之后，在等待了较长时间的验证后，CLI中报出了如下错误：</p>

<p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162afdd08f96d4ed?w=1240&amp;h=165&amp;f=png&amp;s=76650" alt=""/></p>

<p>这是怎么回事呢？通过查阅一些资料发现，这很可能是你在电脑上使用“翻墙”工具所导致的。firebase-tool依赖的npm包（faye-websocket）中，未开启代理的相关设置，因此无法进行验证。</p>

<p>解决这个问题的方法有两种：</p>

<h3 id="toc_4">方法一：在路由器上设置代理，而非本机</h3>

<p>有些文章指出，通过在路由器上设置代理，而非在本机开启代理，可以避免这个问题。不过由于一些原因，暂时还没有尝试这种方式，不过通过一些反馈来看，应该是一个有效的方法。</p>

<h3 id="toc_5">方法二：(hack) 修改代码与相关环境变量</h3>

<p>该方法较第一种方法来看，会稍微“硬”那么一些。具体的操作方式如下：</p>

<ol>
<li>设置环境变量<code>http_proxy</code>，我本机的代理使用的是1087端口。<code>export http_proxy=http://localhost:1087</code> </li>
<li>修改faye-websocket，开启代理配置。faye-websocket是firebase依赖的一个WebSocket库，需要为其client.js添加如下配置：</li>
</ol>

<pre><code class="language-javascript">var Client = function(_url, protocols, options) {
    options = options || {};
    // 添加proxy配置
    options.proxy = {
        origin:  &#39;http://localhost:1087&#39;,
    };
    …
}
</code></pre>

<p>如果你是全局安装的firebase-tools，你可以通过如下方法找到client.js</p>

<pre><code>NODE_PATH=`npm prefix -g`
// client.js的位置
$NODE_PATH/lib/node_modules/firebase-tools/node_modules/firebase/node_modules/faye-websocket/lib/faye/websocket/client.js
</code></pre>

<ol>
<li><p>设置环境变量NODE_TLS_REJECT_UNAUTHORIZED。<code>export NODE_TLS_REJECT_UNAUTHORIZED=0</code></p></li>
<li><p>重新登录，<code>firebase login --no-localhost</code>，重复之前的操作。你会发现，登录成功！</p></li>
</ol>

<p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162afdd0b8f77b15?w=1177&amp;h=219&amp;f=png&amp;s=44679" alt="image.png"/></p>

<p>【问题二】解决！</p>

<p>p.s. 针对这个问题，github上也有一个issue：<a href="https://github.com/firebase/firebase-tools/issues/155">Unable to deploy behind a proxy</a>。</p>

<p>此外，如果你使用了代理，推荐使用全局代理的方式，使你的CLI也使用代理。</p>

<h2 id="toc_6">写在最后</h2>

<p>最后，还是回到我开发PWA时的需求。文章最开始提到了，我是为了在移动端测试PWA demo的效果，所以使用FireBase来托管资源。当然，除了FireBase，还有下面两个办法：</p>

<ol>
<li><p>使用github page。由于github全站都是运行在HTTPS下，因此在github page上托管的静态站点可以使用Service Worker；</p></li>
<li><p>使用localhost/127.0.0.1。了解PWA的话，你会知道除了HTTPS之外，也可以使用localhost（这一设计是为了方便本机调试）。</p></li>
</ol>

<p>本文是《PWA学习与实践》系列中的第四篇。这篇文章并没有探讨PWA中实际的技术，而是记录了我在开发、调试P过程与遇到的问题。可能有朋友也会遇到类似问题，因此记录下来和大家分享。</p>

<p>在下一篇文章中，我们还是会回到PWA背后的技术，来了解一下，<strong>如何使用Push API来实现后端服务向客户端进行消息推送</strong>。</p>


		</div>
	

 
	

 
	

 
	

  
  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
