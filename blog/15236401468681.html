<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å— - AlienZHOU's blog
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="AlienZHOU's blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">AlienZHOU's blog</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; AlienZHOU's blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>PWA</label></li>

          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜" href="15235166926023.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨" href="15235151669706.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…" href="15235138633619.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…</a></li>
          
            <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€" href="15235140795593.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€</a></li>
          

      
        <li class="divider"></li>
        <li><label>React</label></li>

          
            <li><a title="åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ" href="15236392559880.html">åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</a></li>
          
            <li><a title="åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰" href="15235187668595.html">åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</a></li>
          

      
        <li class="divider"></li>
        <li><label>CSS</label></li>

          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘" href="15236398426783.html">ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘</a></li>
          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS" href="15236396803035.html">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS</a></li>
          
            <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope" href="15236395841604.html">ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a></li>
          

      
        <li class="divider"></li>
        <li><label>Server</label></li>

          
            <li><a title="ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹" href="15236400113573.html">ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a></li>
          

      
        <li class="divider"></li>
        <li><label>Automation</label></li>

          
            <li><a title="Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—" href="15236401468681.html">Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</a></li>
          

      
        <li class="divider"></li>
        <li><label>FE else</label></li>

          
            <li><a title="æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»" href="15236404711802.html">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a></li>
          
            <li><a title="JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ" href="15236403350295.html">JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</a></li>
          
            <li><a title="jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰" href="15236405992551.html">jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>PWA</span></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜" href="15235166926023.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(4) è§£å†³FireBase loginéªŒè¯å¤±è´¥é—®é¢˜</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨" href="15235151669706.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(3) è®©ä½ çš„WebAppç¦»çº¿å¯ç”¨</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…" href="15235138633619.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(1) 2018ï¼Œå¼€å§‹ä½ çš„PWAå­¦ä¹ ä¹‹æ—…</a></li>
                        
                          <li><a title="ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€" href="15235140795593.html">ã€PWAå­¦ä¹ ä¸å®è·µã€‘(2) ä½¿ç”¨Manifestï¼Œè®©ä½ çš„WebAppæ›´â€œNativeâ€</a></li>
                        

                    
                      <li class="side-title"><span>React</span></li>
                        
                          <li><a title="åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ" href="15236392559880.html">åŸºäºreactæŠ€æœ¯æ ˆçš„å•é¡µåº”ç”¨(SPA)æ­å»º_å¿«é€Ÿå…¥é—¨å®è·µ</a></li>
                        
                          <li><a title="åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰" href="15235187668595.html">åœ¨react-router4ä¸­è¿›è¡Œä»£ç æ‹†åˆ†ï¼ˆåŸºäºwebpackï¼‰</a></li>
                        

                    
                      <li class="side-title"><span>CSS</span></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘" href="15236398426783.html">ã€CSSæ¨¡å—åŒ–ã€‘(3) ä½¿ç”¨ğŸ’…styled-componentsæ¥ä¼˜åŒ–reactç»„ä»¶å¼€å‘</a></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS" href="15236396803035.html">ã€CSSæ¨¡å—åŒ–ã€‘(2) BEMå‘½åæ–¹æ³•è®ºâ€”â€”ä½¿ç”¨BEM-constructoræ„å»ºCSS</a></li>
                        
                          <li><a title="ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope" href="15236395841604.html">ã€CSSæ¨¡å—åŒ–ã€‘(1) webpackä¹‹Local Scope</a></li>
                        

                    
                      <li class="side-title"><span>Server</span></li>
                        
                          <li><a title="ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹" href="15236400113573.html">ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a></li>
                        

                    
                      <li class="side-title"><span>Automation</span></li>
                        
                          <li><a title="Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—" href="15236401468681.html">Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</a></li>
                        

                    
                      <li class="side-title"><span>FE else</span></li>
                        
                          <li><a title="æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»" href="15236404711802.html">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»</a></li>
                        
                          <li><a title="JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ" href="15236403350295.html">JavaScriptå¼‚æ­¥ç¼–ç¨‹__â€œå›è°ƒåœ°ç‹±â€çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</a></li>
                        
                          <li><a title="jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰" href="15236405992551.html">jsæ§åˆ¶inputæ¡†å†…å…‰æ ‡ä½ç½®ï¼ˆsetSelectionRangeè¯¦è§£ï¼‰</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>Gulp.jså®è·µè¯¦è§£__åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å—</h1>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-d582b5c044741c44.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""/></p>

<h2 id="toc_0">1. ä»€ä¹ˆæ˜¯å¤šé¡µåº”ç”¨</h2>

<p>ç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“å•é¡µé¢åº”ç”¨SPAï¼ˆsingle page web applicationï¼‰ï¼Œé‚£ä¹ˆä¸å…¶ç›¸å¯¹çš„å°±æ˜¯å¤šé¡µé¢åº”ç”¨ï¼Œæˆ–è€…è¯´æ˜¯è¿™ç§æ›´ä¸ºä¼ ç»Ÿçš„ç«™ç‚¹â€”â€”é€šè¿‡åç«¯è·¯ç”±æ§åˆ¶ï¼Œè®¿é—®ä¸åŒurlä¼šç”±æœåŠ¡å™¨åå‡ºä¸åŒçš„é¡µé¢ä¸é¡µé¢èµ„æºã€‚ç”±äºSEOç­‰ä¸€äº›å› ç´ ï¼Œè¿™ç§å¤šé¡µé¢çš„åº”ç”¨ï¼ˆæˆ–è€…è¯´æ˜¯ç«™ç‚¹æ›´åˆé€‚ï¼‰å¦‚ä»Šä»ç„¶æ˜¯ä¸€ç§éå¸¸é‡è¦çš„å½¢å¼ã€‚</p>

<p>ç”±äºè¿‘æœŸçš„é¡¹ç›®å½¢æ€å°±æ˜¯è¿™æ ·çš„ï¼Œè€Œåœ¨é¡¹ç›®ä¸­æœ€åé€‰æ‹©ä½¿ç”¨äº†gulpä½œä¸ºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œä½†æ˜¯ç½‘ä¸Šçš„å„ç±»ç›¸å…³åšæ–‡éƒ½æ¯”è¾ƒé›¶ç¢ï¼Œä¸å¤Ÿç³»ç»Ÿï¼›åŒæ—¶åœ¨å®é™…åº”ç”¨ä¸­å°¤å…¶æ˜¯å¤šé¡µé¢ç«™ç‚¹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ä¹Ÿæ²¡æœ‰ç‰¹åˆ«å¥½çš„å®è·µï¼Œå› æ­¤ï¼Œå°†é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆæ•´ç†äº†ä¸€ä¸‹ã€‚</p>

<p>åŒæ—¶ï¼Œå€Ÿç€é¡¹ç›®ä¸­ç¢°åˆ°çš„é—®é¢˜ï¼Œä¹Ÿè¯»äº†gulpåŠå…¶ä¸€äº›ç›¸å…³åº“çš„æºç ï¼Œä¹‹åä¹Ÿä¼šè€ƒè™‘å†™ä¸€äº›çŸ­æ–‡æ¥è¿›è¡Œäº¤æµã€‚</p>

<h2 id="toc_1">2. ä»€ä¹ˆæ˜¯Gulp</h2>

<p>ç›¸ä¿¡å¤§å®¶å¯¹Gulpåº”è¯¥ä¸ä¼šå¤ªé™Œç”Ÿï¼Œç”¨ä¸€å¥Gulpå®˜æ–¹çš„è¯æ¥è¯´ï¼š</p>

<blockquote>
<p>Gulpå°±æ˜¯åŸºäºæµçš„å‰ç«¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·</p>
</blockquote>

<p>å¦‚æœä½ å®Œå…¨ä¸äº†è§£gulpï¼Œå»ºè®®å¯ä»¥å…ˆç®€å•æµè§ˆä¸€ä¸‹<a href="https://gulpjs.com/">gulpçš„å®˜ç½‘</a></p>

<blockquote>
<p>gulpæ˜¯å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­å¯¹ä»£ç è¿›è¡Œæ„å»ºçš„å·¥å…·ï¼Œæ˜¯è‡ªåŠ¨åŒ–é¡¹ç›®çš„æ„å»ºåˆ©å™¨ï¼›å®ƒä¸ä»…èƒ½å¯¹ç½‘ç«™èµ„æºè¿›è¡Œä¼˜åŒ–ï¼Œè€Œä¸”åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¾ˆå¤šé‡å¤çš„ä»»åŠ¡èƒ½å¤Ÿä½¿ç”¨æ­£ç¡®çš„å·¥å…·è‡ªåŠ¨å®Œæˆï¼›ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥å¾ˆæ„‰å¿«çš„ç¼–å†™ä»£ç ï¼Œè€Œä¸”å¤§å¤§æé«˜æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚</p>
</blockquote>

<p>å¼€å‘è€…å¯ä»¥åœ¨æ–‡ä»¶è¯»å–ä¸è¾“å‡ºä¸­è¿›è¡Œç›¸åº”çš„æ“ä½œä¸å¤„ç†ï¼Œä»è€Œä½¿è¾“å‡ºçš„æ–‡ä»¶æ»¡è¶³ç”Ÿäº§è¦æ±‚ï¼Œå®ç°è‡ªåŠ¨åŒ–ã€‚å…¶æ ¸å¿ƒéƒ¨åˆ†ä¸»è¦æœ‰ä¸¤å—ï¼švinylä¸vinyl-fsç»„æˆçš„åŸºäºæ–‡ä»¶çš„ä¸€ç§objectModeæµåŠå…¶ç›¸å…³æ“ä½œï¼Œä»¥åŠorchestratorè¿™ä¸ªä»»åŠ¡ä»¥æ¥ä¸æ§åˆ¶ç³»ç»Ÿï¼ˆä½†æ˜¯gulp4.0å¥½åƒå·²ç»èˆå¼ƒäº†å®ƒï¼‰ã€‚å½“ç„¶ï¼Œæœ¬æ–‡ä¸ä¼šæ¥ä»‹ç»è¿™ä¸¤éƒ¨åˆ†çš„åŸç†æˆ–è€…å®ç°ï¼ˆè¿™éƒ¨åˆ†å†…å®¹ä¼šæ”¾åœ¨ä¹‹åçš„æ–‡ç« é‡Œï¼‰ï¼Œè€Œæ˜¯èšç„¦äºå…¶å®é™…çš„é¡¹ç›®åº”ç”¨ã€‚</p>

<h2 id="toc_2">3. åœ¨å¤šé¡µåº”ç”¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜</h2>

<p>é¦–å…ˆï¼Œåœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è‚¯å®šä¼šé‡åˆ°å„ç§ä¾èµ–å…³ç³»çš„ç®¡ç†ã€‚ç„¶è€Œå¦‚æœä¸ç”¨ä¸€äº›å‰ç«¯çš„ä¾èµ–ç®¡ç†æ¡†æ¶ï¼Œæµè§ˆå™¨æ˜¯æ— æ³•åŸç”Ÿæ”¯æŒå„ç§æ¨¡å—åŒ–è§„èŒƒçš„ï¼Œè€Œè‡ªåŠ¨åŒ–å·¥å…·çš„ä¸€å¤§ç›®æ ‡å°±æ˜¯å®ç°å®ƒä»¬ï¼ˆæˆ–è€…è¯´è®©ä½ å¼€å‘èµ·æ¥æ„Ÿè§‰åƒæ˜¯å®ç°äº†ï¼‰ã€‚</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-c78145e9df14fa47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¡¹ç›®å¼€å‘æ—¶çš„å„ç§ä¾èµ–å…³ç³»"/></p>

<p>ä¸Šå›¾å°±æ˜¯æˆ‘ä»¬éœ€è¦é¢å¯¹çš„ç¹æ‚çš„ä¾èµ–å…³ç³»ã€‚ä¸åƒå•é¡µï¼ˆSPAï¼‰åº”ç”¨ä¸­æ‰€æœ‰çš„JavaScriptæ¨¡å—éƒ½ä¼šæ‰“åŒ…ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼ˆå½“ç„¶å¯èƒ½ä¼šæœ‰ä¸€äº›ä»£ç æ‹†åˆ†ä¹‹ç±»çš„å·¥ä½œï¼Œä½†å…¶æœ¬è´¨ä¸Šè¿˜æ˜¯å°†æ•´ä¸ªç«™ç‚¹çš„è·¯ç”±ç­‰é¡µé¢æ§åˆ¶çš„é€»è¾‘å‰ç½®åˆ°äº†æµè§ˆå™¨ç«¯ï¼‰ï¼›ä¸ä¹‹å¯¹åº”çš„ï¼Œå¤šé¡µé¢åº”ç”¨åˆ™å¯ä»¥è¯´æ˜¯ä¸€ç§æ›´ä¸ºä¼ ç»Ÿï¼Œé€šè¿‡åç«¯è·¯ç”±æ¥è¿›è¡Œé¡µé¢çš„è·³è½¬ã€‚</p>

<p>å› æ­¤ä¸å•é¡µåº”ç”¨æœ€å¤§çš„ä¸åŒå°±åœ¨äºï¼Œå…¶æ‰“åŒ…å‡ºçš„æ–‡ä»¶å†³ä¸èƒ½æ˜¯ä¸€ä¸ªå•ä¸€çš„æ–‡ä»¶ï¼ˆä¸€ä¸ªJavaScriptæ–‡ä»¶å’Œä¸€ä¸ªCSSæ–‡ä»¶ï¼‰ã€‚é¡µé¢å¯èƒ½ä¼šåŒ…å«ä¸€äº›å…¬å…±éƒ¨åˆ†ï¼Œä½†æ¯ä¸ªé¡µé¢è‡³å°‘éœ€è¦å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„JavaScriptä¸ä¸€ä¸ªç‹¬ç«‹çš„CSSæ–‡ä»¶ã€‚å› æ­¤ï¼Œåœ¨å„ç§å¤æ‚çš„å¤„ç†åï¼Œå¯¹äºå¤šé¡µé¢åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ˜¾ç°ä¸‹å›¾çš„æ•ˆæœã€‚</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-071fe32a56dc9b70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"/></p>

<p>å…¶æ¬¡ï¼Œåœ¨ç®¡ç†æ¨¡å—åŒ–ä¾èµ–ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é¢„å¤„ç†ä¸€äº›æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼šå°†lessæ–‡ä»¶ç¼–è¯‘ä¸ºcssæ–‡ä»¶ï¼Œé€šè¿‡babelæ¥ä½¿æˆ‘ä»¬çš„es6ä»£ç èƒ½è¿è¡Œåœ¨ä¸æ”¯æŒes6çš„æµè§ˆå™¨ç­‰ç­‰ã€‚</p>

<p>æ­¤å¤–ï¼Œç±»ä¼¼åœ¨å•é¡µåº”ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å¤šé¡µé¢çš„æƒ…å†µä¸‹ä¹Ÿä¼šè¦å¤„ç†ã€‚ä¾‹å¦‚æ›¿æ¢HTMLä¸­çš„ç¯å¢ƒå˜é‡ï¼Œå¤„ç†CSSä¸­çš„é›ªç¢§å›¾ï¼Œç”šè‡³è§„é¿ä¸€äº›ä»£ç æ£€æŸ¥ç­‰ç­‰ã€‚</p>

<p>æœ€ç»ˆï¼Œæˆ‘ä»¬è¦å°†è¿™äº›å¤„ç†åçš„å†…å®¹å‘å¸ƒåˆ°è¿è¡Œç›®å½•ä¸­ï¼Œå®ç°è‡ªåŠ¨åŒ–æµç¨‹ã€‚</p>

<h2 id="toc_3">4. å¦‚ä½•ç”¨Gulpæ¥è§£å†³è¿™äº›é—®é¢˜ï¼ˆworkflowï¼‰</h2>

<p>å¦‚æœç»†ç»†æ¢³ç†ä¸Šä¸€èŠ‚æ‰€è°ˆåŠçš„å„é¡¹ç›®æ ‡ä¸å·¥ä½œï¼Œå¯ä»¥å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªç´§å¯†ç›¸æ¥çš„å·¥ä½œæµç¨‹ï¼ˆworkflowï¼‰ï¼Œè¿™ä¸€èŠ‚ä¼šè¯¦ç»†è®²è§£å„ä¸ªå·¥ä½œæµç¨‹ã€‚</p>

<h3 id="toc_4">4.1. JSéƒ¨åˆ†</h3>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹JavaScriptéƒ¨åˆ†çš„å·¥ä½œæµç¨‹ï¼š</p>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-a512d598d147d565.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="JavaScriptéƒ¨åˆ†å¤„ç†æµç¨‹"/></p>

<h4 id="toc_5">4.1.1. æ¨¡å—åŒ–æ‰“åŒ…</h4>

<p>é¡¹ç›®ä½¿ç”¨browserifyæ¥å®ç°CommonJSã€‚å¦‚æœç”¨è¿‡browserifyï¼Œåº”è¯¥ä¸ä¼šå¯¹ä¸‹é¢è¿™æ®µä»£ç æ„Ÿåˆ°é™Œç”Ÿï¼š</p>

<pre><code class="language-javascript">browserify({
  entries: $your_entry_arr,
  cache: {},
  packageCache: {},
  plugin: $your_plugin_arr
});
</code></pre>

<p>é€šè¿‡è®¾ç½®ä¸€ä¸ªï¼ˆæˆ–ä¸€äº›ï¼‰å…¥å£æ–‡ä»¶ï¼Œå¯ä»¥å°†å…¥å£æ–‡ä»¶æ‰“åŒ…ä¸ºä¸€ä¸ªæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œåœ¨å¤šé¡µé¢åº”ç”¨ä¸­ï¼Œæœ€é‡è¦çš„æœ‰ç‚¹å°±æ˜¯ï¼Œå„ä¸ªé¡µé¢ä¼šæœ‰è‡ªå·±çš„JavaScriptè„šæœ¬æ–‡ä»¶ã€‚åœ¨é¡¹ç›®å¼€å‘æ—¶ï¼Œåœ¨æ¯ä¸ªHTMLé¡µé¢ä¸­å¼•å…¥ä¸€ä¸ªè¯¥é¡µé¢ç‰¹æœ‰çš„JavaScriptè„šæœ¬ã€‚ä¾‹å¦‚é¡µé¢list.htmlä¸­é€šè¿‡<code>&lt;script src=&quot;../js/list.js&quot;&gt;&lt;/script&gt;</code>å¼•å…¥è„šæœ¬ã€‚è€Œè¯¥è„šæœ¬ä½¿ç”¨CommonJSè§„èŒƒè¿›è¡Œæ¨¡å—åŒ–ã€‚</p>

<pre><code class="language-javascript">// ../js/list.js
const button = require(&#39;./common/button&#39;);
// ä¸€äº›buttonçš„æ“ä½œ
button.render(&#39;#button&#39;);
// â€¦â€¦
</code></pre>

<p>å› æ­¤ï¼Œéœ€è¦é’ˆå¯¹ä¸åŒçš„é¡µé¢ï¼Œæ‰“åŒ…å‡ºå¤šä»½çš„JavaScriptæ–‡ä»¶ã€‚é¦–å…ˆä½¿ç”¨<code>node-glob</code>è·å–æ¯ä¸ªé¡µé¢çš„å…¥å£æ–‡ä»¶ï¼Œå…¶ä¸­<code>SRC_JS_PATH</code>ä¸ºJavaScriptæºç çš„è·¯å¾„</p>

<pre><code class="language-javascript">/**
 * è·å–jså…¥å£æ–‡ä»¶è·¯å¾„ç»„
 * @return {Array} æ–‡ä»¶è·¯å¾„æ•°ç»„
 */
const getEntryJsFiles = () =&gt; (
    glob.sync(`${SRC_JS_PATH}/**/*.js`, {
        ignore: [`${SRC_JS_PATH}/*.dist.js`, `${SRC_JS_PATH}/*.mod.js`]
    })
);
</code></pre>

<p>ç„¶åï¼Œå¯¹æ¯ä¸ªå…¥å£æ–‡ä»¶åˆ›å»ºå…¶å¯¹åº”çš„bundleå¯¹è±¡å¹¶è¿”å›ï¼Œä»¥ä¾¿äºåœ¨æ¯ä¸ªbundleå¯¹è±¡ä¸Šè¿›è¡Œåç»­çš„jsä»»åŠ¡å¤„ç†</p>

<pre><code class="language-javascript">let files = getEntryJsFiles();

// éå†æ‰€æœ‰å…¥å£æ–‡ä»¶ï¼Œç”Ÿæˆbrowserifyå¯¹è±¡
bundleTasks = files.map(ele =&gt; ({
  bundle: browserify({
  entries: [ele],
  cache: {},
  packageCache: {},
  plugin: [watchify]
  }),
  filename: ele
}));
</code></pre>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ª<code>bundleTasks</code>ï¼Œé‡Œé¢ä¿å­˜äº†æ‰€æœ‰é¡µé¢å¯¹åº”çš„å„è‡ªçš„å…¥å£æ–‡ä»¶çš„bundleå¯¹è±¡ä¸æ–‡ä»¶åã€‚ä¸‹é¢æˆ‘ä»¬å°±ä¼šå¯¹æ¯ä¸ªbundleå¯¹è±¡éƒ½åº”ç”¨ä¸Šé¢æµç¨‹å›¾ä¸­çš„å·¥åºè¿›è¡Œå¤„ç†ã€‚æˆ‘ä»¬å…ˆä¿ç•™è¿™ä¸ª<code>bundleTasks</code>æ•°ç»„ï¼Œæ¥è®²è®²å…¶ä»–çš„å·¥ä½œæµç¨‹ã€‚</p>

<h4 id="toc_6">4.1.2. è·¯å¾„ä¿®æ­£</h4>

<p>ç”±äºä½¿ç”¨<code>node-glob</code>è¿›è¡ŒåŒ¹é…ï¼Œæ‰€ä»¥åŒ¹é…åˆ°çš„è·¯å¾„ä¸å•å•åŒ…å«æ–‡ä»¶åï¼Œå¯èƒ½è¿˜ä¼šåŒ…å«æŸäº›ç›®å½•åã€‚ä¾‹å¦‚ï¼Œå¯èƒ½æƒ³è¦åŒ¹é…<code>list.js</code>ï¼Œä½†æ˜¯ç”±äºå·¥ä½œè·¯å¾„ç­‰åŸå› ï¼Œå®é™…è¾“å‡ºçš„è·¯å¾„åä¸º<code>./page/list.js</code>ã€‚é‚£ä¹ˆä¸è¿›è¡Œå¤„ç†ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>

<p>å¦‚æœç›´æ¥ä½¿ç”¨<code>gulp.dest</code>è¿›è¡Œè¾“å‡ºï¼Œé»˜è®¤ä¼šå¸¦ä¸ŠåŒ¹é…å‡ºæ¥çš„è·¯å¾„é‡Œé¢çš„æ‰€æœ‰ç‰‡æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯èƒ½åªå¸Œæœ›åœ¨distç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªlist.jsæ–‡ä»¶ï¼Œä½†å®é™…ä¸Šä¼šç”Ÿæˆä¸€ä¸ªpageç›®å½•ï¼Œç›®å½•é‡ŒåŒ…å«list.jsæ–‡ä»¶ã€‚è¿™å°±ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚äº†ã€‚å› æ­¤ï¼Œä½¿ç”¨<code>gulp-rename</code>è¿›è¡Œè·¯å¾„è°ƒæ•´ï¼ˆå½“ç„¶ï¼Œ<code>gulp-rename</code>ä¹Ÿå¯ä»¥é‡å‘½åæ–‡ä»¶ï¼‰ã€‚</p>

<p>åœ¨è¿™é‡Œï¼Œè¿˜è¦æ¨èä¸€ä¸ªgulpå·¥å…·ï¼š<code>gulp-load-plugins</code>ã€‚å®ƒå¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬åŠ è½½<code>gulp-</code>å¼€å¤´çš„å„ç±»gulpæ’ä»¶ã€‚å› æ­¤ï¼Œå¯ä»¥å¾ˆæ–¹é¢å¾—è¿›è¡Œè·¯å¾„è°ƒæ•´ã€‚</p>

<pre><code class="language-javascript">.pipe(plugins.rename({
  dirname: &#39;&#39;
}))
</code></pre>

<p>æˆ‘ä»¬éœ€è¦å°†è¯¥æ­¥å¤„ç†ç½®äºæ‰“åŒ…æ“ä½œä¹‹åã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œç”±äºbundleçš„streamæ˜¯ä¸€ä¸ªæ™®é€šæ¨¡å¼çš„streamï¼Œè€Œgulpï¼ˆvinylï¼‰çš„streamåˆ™æ˜¯ä¸€ä¸ªobjectModeçš„streamï¼Œå› æ­¤éœ€è¦ä¸€äº›è½¬åŒ–ä¸å¤„ç†ã€‚è¿™é‡Œå°±ç”¨åˆ°äº†<code>vinyl-source-stream</code>ä¸<code>vinyl-buffer</code>ä¸¤ä¸ªåº“ï¼š</p>

<pre><code class="language-javascript">const source = require(&#39;vinyl-source-stream&#39;);
const buffer = require(&#39;vinyl-buffer&#39;);
const plugins = require(&#39;gulp-load-plugins&#39;)();

bundle
  .pipe(source(filename))
  .pipe(buffer())
  .pipe(plugins.rename({ // ä¿®æ­£è·¯å¾„åç§°
    dirname: &#39;&#39;
  }))
</code></pre>

<h4 id="toc_7">4.1.3. è½¬ç </h4>

<p>è™½ç„¶éƒ¨åˆ†æµè§ˆå™¨å¯¹äºes6è¯­æ³•å·²ç»æœ‰äº†è¾ƒå¥½çš„åŸç”Ÿæ”¯æŒï¼Œä½†æ˜¯ä¸ºäº†èƒ½æ›´å¥½å¾—ä¿è¯es6ä»£ç åœ¨æµè§ˆå™¨ç«¯çš„æ­£å¸¸è¿è¡Œï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨babelè¿™æ ·çš„å·¥å…·æ¥ä½¿å¾—ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä»£ç å…·æœ‰å¾ˆå¥½çš„æµè§ˆå™¨å…¼å®¹æ€§ï¼ˆè½¬ä¸ºes5ï¼‰ã€‚è€Œåœ¨gulpä¸­åªéœ€ä½¿ç”¨<code>gulp-babel</code>æ’ä»¶å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°ï¼Œåªéœ€ç®€å•å‡ è¡Œä»£ç ï¼š</p>

<pre><code class="language-javascript">.pipe(plugins.babel({
  presets: [&#39;env&#39;]
}))
</code></pre>

<p>æˆ‘ä»¬å°†è¯¥æ­¥æ“ä½œç½®äºç¬¬äºŒæ­¥ä¸­çš„pipeä¹‹åã€‚</p>

<pre><code class="language-javascript">const source = require(&#39;vinyl-source-stream&#39;);
const buffer = require(&#39;vinyl-buffer&#39;);
const plugins = require(&#39;gulp-load-plugins&#39;)();

bundle
  .pipe(source(filename))
  .pipe(buffer())
  .pipe(plugins.rename({
    dirname: &#39;&#39;
  }))
  .pipe(plugins.babel({ // babel
    presets: [&#39;env&#39;]
  }))
</code></pre>

<h4 id="toc_8">4.1.4. ç¦ç”¨ä»£ç æ£€æŸ¥</h4>

<p>ç”±äºé¡¹ç›®çš„ä¸€äº›ç‰¹æ®ŠåŸå› ï¼Œéœ€è¦å°†å¼€å‘æ—¶çš„æºç å’Œå‘å¸ƒçš„ç”Ÿäº§ç¯å¢ƒä»£ç ä¸€åŒä¸Šä¼ åˆ°çº¿ä¸Šä»£ç åº“ï¼ŒåŒæ—¶éœ€è¦é€šè¿‡jslintçš„ä¸€äº›ä»£ç æ£€æŸ¥ã€‚ä½†æ˜¯å‘å¸ƒåçš„ä»£ç å¾ˆå¤šæ—¶å€™æ˜¯ä¸ç¬¦åˆä»£ç è§„èŒƒçš„ï¼Œå› æ­¤ï¼Œéœ€è¦é€šè¿‡æ·»åŠ ä¸€äº›æ³¨é‡Šæ¥å–æ¶ˆå¯¹éƒ¨åˆ†å‘å¸ƒåä»£ç çš„æ£€æŸ¥ã€‚</p>

<p>è¿™ä¸ªæ’ä»¶ä¹Ÿéå¸¸ç®€å•ï¼Œé€šè¿‡åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œä¸ºæ–‡ä»¶å¤´éƒ¨åŠ å…¥ç‰¹å®šçš„æ³¨é‡Šæ–‡æœ¬å³å¯ï¼š</p>

<pre><code class="language-javascript">const through = require(&#39;through2&#39;);
const gutil = require(&#39;gulp-util&#39;);
const path = require(&#39;path&#39;);
const DIS_LINTER = {
    html: &#39;&lt;!-- htmlcs-disable --&gt;&#39;,
    css: &#39;/* csshint-disable */&#39;,
    js: &#39;/*eslint-disable */&#39;
};

const dislint = preText =&gt; {
  let js = new Buffer(`${DIS_LINTER[&#39;js&#39;]}\n`);
  let css = new Buffer(`${DIS_LINTER[&#39;css&#39;]}\n`);
  let html = new Buffer(`${DIS_LINTER[&#39;html&#39;]}\n`);
  let buf = {
    html,
    css,
    js
  };

  return through.obj((chunk, enc, cb) =&gt; {
    let ext = &#39;&#39;;
    try {
      ext = path.extname(chunk.path);
    }
    catch (err) {
      console.log(err);
    }
    ext = ext.length &gt; 0 ? ext.slice(1) : &#39;js&#39;;

    // gutil.log(gutil.colors.magenta(&#39;[Disable Linter]&#39;), chunk.path);
    let preBuf = preText &amp;&amp; preText.length &gt; 0 ? new Buffer(preText) : buf[ext];
    if (chunk.isNull()) {
      cb(null, chunk);
    }
    if (chunk.isBuffer()) {
      chunk.contents = Buffer.concat([preBuf, chunk.contents]);
    }
    if (chunk.isStream()) {
      let stream = through();
      stream.write(preBuf);
      chunk.contents = chunk.contents.pipe(stream);
    }
    cb(null, chunk);
  });
};

module.exports = dislint;
</code></pre>

<p>ä½¿ç”¨è¯¥æ’ä»¶ï¼š</p>

<pre><code class="language-javascript">const source = require(&#39;vinyl-source-stream&#39;);
const buffer = require(&#39;vinyl-buffer&#39;);
const plugins = require(&#39;gulp-load-plugins&#39;)();
const dislint = require(&#39;./dislint&#39;);

bundle
  .pipe(source(filename))
  .pipe(buffer())
  .pipe(plugins.rename({
    dirname: &#39;&#39;
  }))
  .pipe(plugins.babel({
    presets: [&#39;env&#39;]
  }))
  .pipe(dislint()) // å–æ¶ˆä»£ç æ£€æŸ¥
</code></pre>

<h4 id="toc_9">4.1.5. æ·»åŠ md5æˆ³å¹¶è¾“å‡º</h4>

<p>ä¸ºäº†é˜²æ­¢ç”¨æˆ·æµè§ˆå™¨ç¼“å­˜å½±å“èµ„æºæ›´æ–°ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ md5æˆ³çš„æ–¹å¼ï¼Œæ¥æ”¹å˜æ–‡ä»¶åç§°ã€‚è¿™é‡Œç”¨åˆ°äº†<code>gulp-md5Plus</code>è¿™ä¸ªæ’ä»¶ã€‚</p>

<p>æ­¤å¤–ï¼Œåœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¦ç”¨æµè§ˆå™¨ç¼“å­˜ä¿è¯è·å–æœ€æ–°çš„èµ„æºï¼Œå› æ­¤ï¼Œåœ¨å¼€å‘é˜¶æ®µå¯ä»¥ç¦ç”¨ç”Ÿæˆmd5çš„åŠŸèƒ½ã€‚è¦æ ¹æ®ä¸åŒçš„ç¯å¢ƒè¿›è¡Œä¸åŒçš„æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡è¿›è¡Œæ‰§è¡Œã€‚<code>gulp-util</code>æä¾›äº†è¿™ä¸€åŠŸèƒ½ã€‚<code>gulp-util</code>æ˜¯gulpå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªgulpçš„å¸¸ç”¨åŠŸèƒ½å·¥å…·ç®±ï¼Œé‡Œé¢åŒ…å«äº†logã€ç±»å‹åˆ¤æ–­ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚</p>

<p>è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šåœ¨éç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨<code>gutil.noop()</code>ä½œä¸ºä¸€ä¸ªä¸è¿›è¡Œä»»åŠ¡å¤„ç†çš„streamå¯¼å‡ºï¼›è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨<code>gulp-md5Plus</code>æ¥å®ç°md5ã€‚æœ€åï¼Œå°†å¤„ç†åçš„æ–‡ä»¶è¾“å‡ºåˆ°æŒ‡å®šçš„å‘å¸ƒç›®å½•ï¼š</p>

<pre><code class="language-javascript">const source = require(&#39;vinyl-source-stream&#39;);
const buffer = require(&#39;vinyl-buffer&#39;);
const plugins = require(&#39;gulp-load-plugins&#39;)();
const dislint = require(&#39;./dislint&#39;);
const gutil = require(&#39;gulp-util&#39;);

bundle
  .pipe(source(filename))
  .pipe(buffer())
  .pipe(plugins.rename({
    dirname: &#39;&#39;
  }))
  .pipe(plugins.babel({
    presets: [&#39;env&#39;]
  }))
  .pipe(dislint())
  .pipe(gutil.env.env === &#39;production&#39; ? plugins.md5Plus(5, `${DIST_HTML_PATH}/**/*.html`) : gutil.noop())  // md5
  .pipe(gulp.dest(DIST_JS_PATH)) // å‘å¸ƒæ–‡ä»¶
</code></pre>

<h4 id="toc_10">4.1.6. é”™è¯¯å¤„ç†</h4>

<p>ç”±äºgulpæ˜¯åŸºäºstreamçš„æ“ä½œï¼Œå› æ­¤ä½¿ç”¨tryâ€¦catchâ€¦è¯­æ³•æ˜¾ç„¶æ˜¯æ— æ³•å¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ï¼›å–è€Œä»£ä¹‹å°±éœ€è¦ç›‘å¬streamä¸Šçš„erroräº‹ä»¶ã€‚ä½†æ˜¯ï¼Œåœ¨ä»£ç é‡Œï¼Œæˆ‘ä»¬æ€»ä¸èƒ½åœ¨æ¯ä¸ª<code>.pipe()</code>ååŠ ä¸Š<code>.on(&#39;error&#39;, function(){}})</code>è¿™æ ·çš„ä»£ç å§ï¼Œé‚£ä¹Ÿå¤ªè‡ƒè‚¿äº†ã€‚</p>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>gulp-plumber</code>æ’ä»¶ã€‚åªéœ€è¦åœ¨streamçš„æœ€å‰é¢åŠ ä¸Šå®ƒï¼Œå°±å¯ä»¥äº†ã€‚</p>

<pre><code class="language-javascript">bundle
  .pipe(plugins.plumber(err =&gt; {
    log(red(`[${err.plugin}]`), red(err.message));
  }))
  .pipe(source(filename))
  .pipe(buffer())
  .pipe(plugins.rename({
    dirname: &#39;&#39;
  }))
  .pipe(plugins.babel({
    presets: [&#39;env&#39;]
  }))
  .pipe(dislint())
  .pipe(gutil.env.env === &#39;production&#39; ? plugins.md5Plus(5, `${DIST_HTML_PATH}/**/*.html`) : gutil.noop())  // md5
  .pipe(gulp.dest(DIST_JS_PATH)) // å‘å¸ƒæ–‡ä»¶
</code></pre>

<h4 id="toc_11">4.1.7. å°è£…ä»»åŠ¡</h4>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä¸€ç³»åˆ—ä»»åŠ¡æ˜¯æ¯ä¸ªå…¥å£jsæ–‡ä»¶éƒ½ä¼šç»å†çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†â€œè·¯å¾„ä¿®æ­£--&gt;è½¬ç --&gt;ç¦ç”¨ä»£ç æ£€æŸ¥--&gt;md5--&gt;è¾“å‡ºâ€è¿™ä¸ªæµç¨‹å°è£…ä¸ºä¸€ä¸ªå«åšjsTaskçš„ä»»åŠ¡ï¼Œå¹¶åº”ç”¨åœ¨æ¯ä¸ªbundleä¸Šã€‚</p>

<pre><code class="language-javascript">/**
 * jsä»»åŠ¡æµï¼Œå…·ä½“åŒ…æ‹¬ï¼š
 * æ¨¡å—æ‰“åŒ… --&gt; è·¯å¾„ä¿®æ­£(é‡å‘½å) --&gt; babel --&gt; å–æ¶ˆä»£ç æ£€æŸ¥ --&gt; md5(productionçŠ¶æ€) --&gt; äº§å‡º
 * @param {Object} bundle å„å…¥å£æ–‡ä»¶çš„browserifyå¯¹è±¡
 * @param {string} filename å…¥å£æ–‡ä»¶å
 * @return {stream} stream å¯¹è±¡
 */
const jsTask = ({bundle, filename}) =&gt; (
    bundle.bundle((err, buf) =&gt; {
        if (err) {
            // æµè§ˆå™¨æç¤º
            browserSync.notify(`[Browserify Error] ${err.message}`, 10000);
            log(red(&#39;[Browserify Error]&#39;), red(err.message));
        }
    })
    .pipe(plugins.plumber(err =&gt; {
        log(red(`[${err.plugin}]`), red(err.message));
    }))
    .pipe(source(filename))
    .pipe(buffer())
    .pipe(plugins.rename({
        dirname: &#39;&#39;
    }))
    .pipe(plugins.babel({
        presets: [&#39;env&#39;]
    }))
    .pipe(dislint())
    .pipe(gutil.env.env === &#39;production&#39; ? plugins.md5Plus(5, `${DIST_HTML_PATH}/**/*.html`) : gutil.noop())
    .pipe(gulp.dest(DIST_JS_PATH))
);
</code></pre>

<p><code>jsTask</code>ä¼šåŒ…è£…å¹¶è¿”å›æ•´ä¸ªjsä»»åŠ¡çš„æµã€‚åŸºäºä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª<code>dist:js</code>ä»»åŠ¡æ¥å‘å¸ƒjsä»£ç ï¼š</p>

<pre><code class="language-javascript">/**
 * è·å–jså…¥å£æ–‡ä»¶è·¯å¾„ç»„
 * @return {Array} æ–‡ä»¶è·¯å¾„æ•°ç»„
 */
const getEntryJsFiles = () =&gt; (
  glob.sync(`${SRC_JS_PATH}/**/*.js`, {
    ignore: [`${SRC_JS_PATH}/*.dist.js`, `${SRC_JS_PATH}/*.mod.js`]
  })
);

// [å‘å¸ƒ]jsä»£ç ï¼Œå…¶ä¸­ä¼šè¿›è¡Œjsç›¸å…³å·¥ä½œæµç¨‹
gulp.task(&#39;dist:js&#39;, cb =&gt; {
  let files = getEntryJsFiles();

  // éå†æ‰€æœ‰å…¥å£æ–‡ä»¶ï¼Œç”Ÿæˆbrowserifyå¯¹è±¡
  bundleTasks = files.map(ele =&gt; ({
    bundle: browserify({
      entries: [ele],
      cache: {},
      packageCache: {},
      plugin: [watchify]
    }),
    filename: ele
  }));

  // æ˜ å°„ä¸åˆå¹¶jsæµ
  let streams = bundleTasks.map(jsTask);
  return es.merge(streams);
});

// [åˆ é™¤]å‘å¸ƒç›®å½•ä¸‹çš„jsæ–‡ä»¶
gulp.task(&#39;del:js&#39;, () =&gt; del.sync([`${DIST_JS_PATH}/*`]));
</code></pre>

<h4 id="toc_12">4.1.8. è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨</h4>

<p>å‰ç«¯å¼€å‘éœ€è¦é¢‘ç¹ä¿®æ”¹å¹¶å¸Œæœ›èƒ½çœ‹åˆ°æµè§ˆå™¨ä¸­å±•ç°çš„æƒ…å†µï¼Œå› æ­¤ï¼Œè§£æ”¾ä½ çš„F5æ˜¾ç„¶å¾ˆæœ‰å¿…è¦ã€‚åœ¨é¡¹ç›®é‡Œï¼Œå¯ä»¥ä½¿ç”¨<code>browserSync</code>æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>

<p><code>browserSync</code>å¯ä»¥åœ¨ä»£ç æ›´æ–°æ—¶è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ï¼ŒåŒæ—¶è¿˜å¯ä»¥å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯è¿›è¡Œå±•ç¤ºã€‚ä½¿ç”¨<code>browserSync</code>ï¼Œå¯ä»¥å»ºç«‹ç›¸åº”çš„gulpä»»åŠ¡ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œgulpæ—¶å¯åŠ¨browserSyncï¼Œå¹¶åˆ›å»ºreload:browserä»»åŠ¡ï¼Œè¿™æ ·åœ¨éœ€è¦çš„æ—¶å€™å°±èƒ½æ–¹ä¾¿å¾—è§¦å‘æµè§ˆå™¨åˆ·æ–°ã€‚</p>

<pre><code class="language-javascript">const browserSync = require(&#39;browser-sync&#39;).create();

// [å¯åŠ¨]browserSync
gulp.task(&#39;start:browserSync&#39;, () =&gt; browserSync.init({
  proxy: &#39;192.168.11.23&#39;,
  notify: true
}));

// åˆ·æ–°æµè§ˆå™¨
gulp.task(&#39;reload:browser&#39;, cb =&gt; {
  browserSync.reload();
  cb();
});
</code></pre>

<h4 id="toc_13">4.1.9. å¢é‡å‘å¸ƒ</h4>

<p>ä¸Šé¢ä»‹ç»äº†å¯¹äºä¸€ä¸ªjså…¥å£æ–‡ä»¶çš„æ•´å¥—å·¥ä½œæµã€‚ç„¶è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¿®æ”¹äº†æŸä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œå¹¶ä¸éœ€è¦å°†æ‰€æœ‰çš„ä»£ç å…¨é‡å†å‘å¸ƒä¸€éï¼Œå¦‚æœèƒ½æ¯æ¬¡åªå¢é‡å¾—å‘å¸ƒä¸ä¿®æ”¹ç›¸å…³çš„jsä»£ç ï¼Œä¼šåœ¨å¼€å‘ä½“éªŒä¸æ•ˆç‡ä¸Šæœ‰è¾ƒå¤§çš„æå‡ã€‚</p>

<p>åŒæ—¶ï¼Œç»“åˆ<code>browserSync</code>å¯ä»¥è®©ä½ çš„å¼€å‘æ•ˆç‡æå¤§è·å¾—æå‡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦<code>watchify</code>æ¥è¿›è¡Œæ–‡ä»¶ç›‘å¬ï¼Œå¹¶å°†å…¶ä½œä¸º<code>browserify</code>çš„æ’ä»¶ï¼Œå®ç°æ–‡ä»¶çš„å¢é‡æ‰“åŒ…ç¼–è¯‘ã€‚é€šè¿‡ç›‘å¬æ¯ä¸ªbundleçš„updateäº‹ä»¶ï¼Œå¯ä»¥åœ¨æ–‡ä»¶æ›´æ–°æ—¶é‡æ–°æ‰“åŒ…å¹¶å¤„ç†å‘å¸ƒï¼Œæœ€ååˆ°streamè§¦å‘endäº‹ä»¶ï¼ˆå¤„ç†å®Œæˆï¼‰æ—¶åˆ·æ–°æµè§ˆå™¨ã€‚</p>

<pre><code class="language-javascript">/**
 * ç›‘å¬å„ä¸ªbrowserifyå¯¹è±¡çš„updateäº‹ä»¶
 * åœ¨æ¨¡å—æ›´æ–°æ—¶æŒ‰éœ€æ‰“åŒ…
 * @param {Object} bundle å„å…¥å£æ–‡ä»¶çš„browserifyå¯¹è±¡
 * @param {string} filename å…¥å£æ–‡ä»¶å
 */
const addBundleTaskListeners = ({bundle, filename}) =&gt; {
  bundle.on(&#39;update&#39;, () =&gt; {
    log(blue(&#39;[Browserify Update]&#39;), filename);
    let sm = jsTask({bundle, filename});
    // æ‰“åŒ…å®Œæˆååˆ·æ–°æµè§ˆå™¨ï¼ˆé”™è¯¯ä¸åˆ·æ–°ï¼Œä¿ç•™notifyï¼‰
    sm.on(&#39;end&#39;, () =&gt; runSequence(&#39;reload:browser&#39;));
  });
};

// [ç›‘å¬]ä¸ºæ‰€æœ‰å…¥å£æ–‡ä»¶å¯¹åº”çš„browserifyå¯¹è±¡æ·»åŠ updateç›‘å¬
gulp.task(&#39;watch:js&#39;, () =&gt; {
  bundleTasks.forEach(item =&gt; {
    addBundleTaskListeners(item);
  });
});
</code></pre>

<h3 id="toc_14">4.2. HTMLéƒ¨åˆ†</h3>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-826361fea7518d59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="HTMLéƒ¨åˆ†å¤„ç†æµç¨‹"/></p>

<p>HTMLéƒ¨åˆ†ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªå·¥ä½œï¼šæ–‡ä»¶å†…å˜é‡çš„æ›¿æ¢ä¸æ–‡ä»¶è·¯å¾„çš„ä¿®æ­£ã€‚</p>

<h4 id="toc_15">4.2.1. æ›¿æ¢æ–‡ä»¶å†…å˜é‡</h4>

<p>åœ¨å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šæœ‰ç±»ä¼¼è¿™æ ·çš„éœ€æ±‚ï¼š<br/>
- åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¼šå¼•ç”¨ä¸€äº›å¼€å‘æœºä¸Šçš„é™æ€èµ„æºï¼›ç„¶è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåˆ™éœ€è¦æ›¿æ¢æˆçº¿ä¸Šçš„CDNåœ°å€ã€‚<br/>
- ååŒå¼€å‘ä¸‹ï¼Œä¸åŒçš„å¼€å‘äººå‘˜å¯èƒ½ä¼šä½¿ç”¨ä¸åŒçš„èµ„æºè·¯å¾„ã€‚<br/>
- ä¸ºæ¯ä¸ªHTMLè®¾ç½®titleå†…å®¹ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†ä¸ºç»Ÿä¸€æ–‡å­—ï¼Œä¾‹å¦‚ï¼šæˆ‘çš„ä¸»é¡µâ€”â€”è´¡çŒ®åˆ—è¡¨ã€æˆ‘çš„ä¸»é¡µâ€”â€”ä¸ªäººè®¾ç½®â€¦å°¤å…¶åœ¨å¼€å‘ä¸­ï¼Œâ€œæˆ‘çš„ä¸»é¡µâ€å¯èƒ½çªç„¶è¦è¢«æ¢æˆâ€œä¸ªäººä¸­å¿ƒâ€ä¹‹ç±»çš„â€¦<br/>
- HTMLä¸­å…¶ä»–ä¸å¸¸æ›´æ”¹ä½†å¯èƒ½éœ€è¦å„å¤„ç»Ÿä¸€çš„éƒ¨åˆ†â€¦</p>

<p>ä¸Šé¢è¿™äº›éœ€æ±‚æˆ‘ä»¬å½“ç„¶å¯ä»¥é€šè¿‡æ‰‹å·¥æ›¿æ¢çš„æ–¹å¼å¼€è§£å†³ï¼Œå®ƒä»¬æœ¬èº«å¹¶æ— å¤ªå¤šæŠ€æœ¯å«é‡ï¼Œä½†å¾ˆæµªè´¹å¼€å‘äººå‘˜çš„ç²¾åŠ›ï¼Œå¹¶ä¸”è¿˜å¯èƒ½å› ä¸ºç²—å¿ƒå¤§æ„äº§ç”Ÿé”™è¯¯æˆ–é—æ¼ã€‚å› æ­¤å¦‚æœèƒ½åœ¨gulpä¸­è‡ªåŠ¨æ›¿æ¢è¿™äº›å˜é‡ï¼Œå¿…ç„¶ä¼šèŠ‚çœå¾ˆå¤šéº»çƒ¦ã€‚</p>

<p>å‚è€ƒä¸€äº›å…¶ä»–å·¥å…·æˆ–è„šæ‰‹æ¶é‡Œçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ•ˆæœæ˜¯ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å®šä¹‰è¿™äº›å˜é‡ï¼ˆä¾‹å¦‚åœ¨.envæˆ–.env.localæ–‡ä»¶ä¸­ï¼‰</p>

<pre><code>$ONE_CDN$=http://cp01-test.XXXX.com
$ONE_TITLE$=æˆ‘çš„ä¸»é¡µ
</code></pre>

<p>ç„¶ååœ¨HTMLä¸­ç›´æ¥ä½¿ç”¨</p>

<pre><code class="language-xml">&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;title&gt;$ONE_TITLE$â€”â€”è´¡çŒ®åˆ—è¡¨&lt;/title&gt;
    &lt;link rel=&quot;shortcut icon&quot; href=&quot;/img/icon.png&quot; /&gt;

    &lt;script src=&quot;$ONE_CDN$/vendors/bower_components/jquery/dist/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;$ONE_CDN$/vendors/bower_components/bootstrap/dist/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;$ONE_CDN$/js/app.min.js&quot;&gt;&lt;/script&gt;
    &lt;link href=&quot;$ONE_CDN$/vendors/bower_components/animate.css/animate.min.css&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;link href=&quot;$ONE_CDN$/vendors/bower_components/bootstrap/dist/js/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
    â€¦â€¦
&lt;/head&gt;
</code></pre>

<p>ä¸‹é¢ï¼Œå°±è¦éœ€è¦ä¸€ä¸ªæ–¹æ³•èƒ½å¤Ÿè¯»å–å‡º.envå’Œ.env.localæ–‡ä»¶ä¸­çš„æ‰€æœ‰å˜é‡ï¼ˆé»˜è®¤å…ˆä½¿ç”¨.env.localï¼Œå¯ä»¥ç†è§£ä¸º.env.localä¼šè¦†ç›–.envä¸­çš„åŒåå˜é‡ï¼‰</p>

<pre><code class="language-javascript">/**
 * trim
 * @param {string} str å¾…å¤„ç†å­—ç¬¦ä¸²
 * @return {string} å¤„ç†åçš„å­—ç¬¦ä¸²
 */
const trim = str =&gt; str.replace(/(^\s*)|(\s*$)/g, &#39;&#39;);

/**
 * è·å–æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡
 * @return {Object} ç¯å¢ƒå˜é‡map
 */
const getEnv = () =&gt; {
    let prepare = [&#39;.env.local&#39;, &#39;.env&#39;];
    let env = {};

    /**
     * æ£€æŸ¥.envä¸­å˜é‡åæ˜¯å¦åˆæ³•
     * å…¨éƒ¨ä½¿ç”¨å¤§å†™å­—æ¯ï¼Œç”¨_è¿æ¥ï¼Œç¬¬ä¸€ä¸ªå•è¯ä¸ºONEï¼Œé¦–å°¾ä½¿ç”¨$
     * @param {string} key å¾…æ£€æŸ¥çš„å˜é‡å
     * @return {boolean} æ£€æŸ¥ç»“æœï¼Œåˆæ³•trueï¼Œéæ³•false
     */
    function envCheck(key) {
        return /^\$ONE(_[A-Z]+)+\$$/.test(key);
    }

    /**
     * è¯»å–æ–‡ä»¶ä¸­çš„å˜é‡
     * @param {string} filename é…ç½®æ–‡ä»¶
     * @return {Object} é…ç½®å˜é‡
     */
    function readEnvFile(filename) {
        let env = {};
        try {
            let filepath = path.resolve(&#39;.&#39;, filename);
            if (fs.existsSync(filepath) &amp;&amp; fs.statSync(filepath).isFile()) {
                fs.readFileSync(filepath, &#39;utf-8&#39;)
                    .split(/\r?\n/)
                    .filter(ele =&gt; ele !== &#39;&#39;)
                    .forEach(ele =&gt; {
                        let pairs = ele.split(&#39;=&#39;);
                        let key = trim(pairs[0]);
                        let value = trim(pairs[1]);
                        if (envCheck(key)) {
                            env[key] = value;
                        }
                        else {
                            log(red(&#39;[env]&#39;), `æ— æ•ˆçš„å˜é‡å: ${key}`, &#39;tip: å…¨éƒ¨ä½¿ç”¨å¤§å†™å­—æ¯ï¼Œç”¨_è¿æ¥ï¼Œç¬¬ä¸€ä¸ªå•è¯ä¸ºONEï¼Œé¦–å°¾ä½¿ç”¨$&#39;);
                        }
                    });
            }
        }
        catch (err) {
            log(red(&#39;[env]&#39;), &#39;è¯»å–envå˜é‡å‡ºé”™&#39;, err);
        }
        finally {
            return env;
        }
    }

    let envArr = [{}];
    // ä¼˜å…ˆå¯»æ‰¾æœ¬åœ°é…ç½®.env.local
    while (prepare.length) {
        // ç”Ÿäº§ç¯å¢ƒä¸‹ä¼˜å…ˆä½¿ç”¨.env
        let filename = gutil.env.env === &#39;production&#39; ? prepare.shift() : prepare.pop();
        envArr.push(readEnvFile(filename));
    }

    return Object.assign.apply(null, envArr);
};
</code></pre>

<p><code>getEnv()</code>æ–¹æ³•å¯ä»¥è¯»å–æ‰€æœ‰å®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¿å­˜ä¸ºä¸€ä¸ªé”®å€¼å¯¹å½¢å¼çš„å¯¹è±¡ï¼Œé”®åæ˜¯å˜é‡åï¼Œå€¼åˆ™æ˜¯å˜é‡çš„å€¼</p>

<pre><code class="language-javascript">// getEnv()
{
  &#39;ONE_CDN&#39;: &#39;http://cp01-test.XXXX.com&#39;,
  &#39;ONE_TITLE&#39;: &#39;æˆ‘çš„ä¸»é¡µ&#39;
}
</code></pre>

<p>ç”±äºè¦æ›¿æ¢æ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>event-stream</code>åº“æ¥è¿›è¡Œstreamçš„æ“ä½œã€‚ä½¿ç”¨å…¶ä¸­çš„<code>.replace()</code>æ–¹æ³•æ¥æ›¿æ¢æ–‡ä»¶å†…å®¹ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p>

<pre><code class="language-javascript">const es = require(&#39;event-stream&#39;);

let pipe = fs.createReadStream(sourceFile);

// æ·»åŠ ç®¡é“ï¼Œæ›¿æ¢.envä¸­çš„ç¯å¢ƒå˜é‡
for (let k in envMap) {
  pipe = pipe.pipe(es.replace(k, envMap[k]));
}
</code></pre>

<h4 id="toc_16">4.4.2. ä¿®æ­£æ–‡ä»¶è·¯å¾„</h4>

<p>ç±»ä¼¼JavaScriptä¸­çš„æ–‡ä»¶è·¯å¾„ä¿®æ­£æ“ä½œï¼Œåœ¨HTMLä¸­åŒæ ·ä½¿ç”¨<code>gulp-rename</code>æ¥å®ç°ï¼Œè·¯å¾„ä¿®æ­£éƒ¨åˆ†ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p>

<pre><code class="language-javascript">// è·¯å¾„æ ¼å¼åŒ–æ­£åˆ™
let reg = new RegExp(`^${path.relative(&#39;.&#39;, SRC_HTML_PATH)}`);

return (
  pipe.pipe(source(sourceFile))
    .pipe(dislint())
    .pipe(plugins.rename(p =&gt; {
      // æ ¼å¼åŒ–ç›®æ ‡è·¯å¾„
      p.dirname = p.dirname.replace(reg, &#39;&#39;);
    }))
    .pipe(gulp.dest(DIST_HTML_PATH))
);
</code></pre>

<h4 id="toc_17">4.2.3. å°è£…ä»»åŠ¡</h4>

<p>å°†å˜é‡æ›¿æ¢ä¸æ–‡ä»¶è·¯å¾„ä¿®æ­£ä¸¤éƒ¨åˆ†ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å‡½æ•°<code>htmlTask</code></p>

<pre><code class="language-javascript">/**
 * htmlå‘å¸ƒä»»åŠ¡
 * @param {string} sourceFile éœ€è¦å‘å¸ƒçš„ç›®æ ‡htmlæ–‡ä»¶
 * @return {stream} æ–‡ä»¶æµ
 */
const htmlTask = sourceFile =&gt; {
  let pipe = fs.createReadStream(sourceFile);

  // æ·»åŠ ç®¡é“ï¼Œæ›¿æ¢.envä¸­çš„ç¯å¢ƒå˜é‡
  for (let k in envMap) {
    pipe = pipe.pipe(es.replace(k, envMap[k]));
  }

  // è·¯å¾„æ ¼å¼åŒ–æ­£åˆ™
  let reg = new RegExp(`^${path.relative(&#39;.&#39;, SRC_HTML_PATH)}`);

  return (
    pipe.pipe(source(sourceFile))
      .pipe(dislint())
      .pipe(plugins.rename(p =&gt; {
        // æ ¼å¼åŒ–ç›®æ ‡è·¯å¾„
        p.dirname = p.dirname.replace(reg, &#39;&#39;);
      }))
      .pipe(gulp.dest(DIST_HTML_PATH))
  );
};
</code></pre>

<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªgulpä»»åŠ¡ç”¨äºHTMLæ–‡ä»¶çš„å‘å¸ƒ</p>

<pre><code class="language-javascript">// [å‘å¸ƒ]htmlé¡µé¢
gulp.task(&#39;dist:html&#39;, () =&gt; {
  let files = glob.sync(`${SRC_HTML_PATH}/**/*.html`);
  let streams = files.map(htmlTask);
  return es.merge(streams);
});
</code></pre>

<p>åŒæ—¶ï¼Œè¿˜éœ€è¦æŠŠå·²æœ‰çš„æ–‡ä»¶åˆ é™¤ï¼Œè¿™é‡Œç”¨åˆ°äº†<code>del</code>è¿™ä¸ªåŒ…</p>

<pre><code class="language-javascript">const del = require(&#39;del&#39;);

// [åˆ é™¤]å‘å¸ƒç›®å½•é¢ä¸‹çš„htmlæ–‡ä»¶
gulp.task(&#39;del:html&#39;, () =&gt; del.sync([`${DIST_HTML_PATH}/*`]));
</code></pre>

<h3 id="toc_18">4.3. CSSéƒ¨åˆ†</h3>

<p><img src="http://upload-images.jianshu.io/upload_images/6476654-ff7268e61e149d78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="CSSéƒ¨åˆ†å¤„ç†æµç¨‹"/></p>

<p>CSSéƒ¨åˆ†çš„å¤„ç†æµç¨‹ä¸­å¤§éƒ¨åˆ†ä¸ä¹‹å‰çš„æ“ä½œå¤§åŒå°å¼‚ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯åœ¨CSSä¸­ä½¿ç”¨åˆ°<code>gulp-less</code>æ’ä»¶ä¸<code>gulp-minify-css</code>æ’ä»¶åˆ†åˆ«å¯¹lessæ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ä¸å‹ç¼©</p>

<pre><code class="language-javascript">gulp.src(`${SRC_CSS_PATH}/**/*.less`) //å¤šä¸ªæ–‡ä»¶ä»¥æ•°ç»„å½¢å¼ä¼ å…¥
  .pipe(less())
  .pipe(minifyCss())
  .pipe(gulp.dest(&#39;dist/css&#39;)); 
</code></pre>

<p>æœ€ç»ˆCSSéƒ¨åˆ†çš„å¤„ç†ä»»åŠ¡å¦‚ä¸‹ï¼š</p>

<pre><code class="language-javascript">// [åˆ é™¤]å‘å¸ƒç›®å½•ä¸‹çš„cssæ–‡ä»¶
gulp.task(&#39;del:css&#39;, () =&gt; del.sync([`${DIST_CSS_PATH}/*`]));

// [å‘å¸ƒ]cssæ–‡ä»¶
gulp.task(&#39;dist:css&#39;, function () {
  gulp.src(`${SRC_CSS_PATH}/**/*.less`) 
    .pipe(plugins.rename({
        dirname: &#39;&#39;
    }))
    .pipe(less())
    .pipe(minifyCss())
    .pipe(gulp.dest(&#39;dist/css&#39;)); 
});
</code></pre>

<h2 id="toc_19">4.4. ç»„åˆä¸ç®¡ç†è¿™äº›ä»»åŠ¡</h2>

<p>æˆ‘ä»¬å®šä¹‰ä¸Šé¢ä¸€ç³»åˆ—çš„ä»»åŠ¡ï¼Œä½†æœ€ç»ˆçš„ç›®æ ‡æ˜¯å°†è¿™äº›ä»»åŠ¡ç»„åˆèµ·æ¥ï¼Œè®©ä»–ä»¬å˜æˆä¸€æ¡æŒ‡ä»¤ï¼ˆæˆ–æŸå‡ æ¡æŒ‡ä»¤ï¼‰ã€‚ä¸ºäº†æ›´å¥½å¾—ç»„ç»‡ä»»åŠ¡ä¾èµ–ï¼Œæ§åˆ¶ä»»åŠ¡æµç¨‹ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>run-sequence</code>æ¥æ§åˆ¶è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œã€‚</p>

<p>æœ€å¸¸è§çš„ï¼Œé¦–å…ˆæ˜¯åœ¨å¼€å‘æ—¶ï¼Œå¸Œæœ›è¾“å…¥<code>gulp</code>å°±å¯ä»¥è¿›å…¥å¼€å‘æ¨¡å¼ï¼Œèƒ½å¤Ÿç›‘å¬å˜åŒ–å¹¶è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ã€‚</p>

<pre><code class="language-javascript">// [ç›‘å¬]ä¸ºæ‰€æœ‰å…¥å£æ–‡ä»¶å¯¹åº”çš„browserifyå¯¹è±¡æ·»åŠ updateç›‘å¬
gulp.task(&#39;watch:js&#39;, () =&gt; {
  bundleTasks.forEach(item =&gt; {
    addBundleTaskListeners(item);
  });
});

// [ç›‘å¬]æ›´æ–°CSS
gulp.task(&#39;watch:css&#39;, () =&gt; {
  gulp.watch([&#39;!**/gulpfile.js&#39;, &#39;src/**/*.css&#39;], () =&gt; {
    runSequence(
      &#39;del:css&#39;,
      &#39;dist:css&#39;,
      &#39;reload:browser&#39;
    );
  });
  cb();
});

// [å¯åŠ¨]browserSync
gulp.task(&#39;start:browserSync&#39;, () =&gt; browserSync.init({
  proxy: &#39;192.168.11.23&#39;,
  notify: true
}));

// åˆ·æ–°æµè§ˆå™¨
gulp.task(&#39;reload:browser&#39;, cb =&gt; {
  browserSync.reload();
  cb();
});

// [ç›‘å¬]htmlæ–‡ä»¶å˜åŒ–
gulp.task(&#39;watch:html&#39;, cb =&gt; {
  // ç›‘å¬htmlå˜åŒ–ï¼Œå…¨é‡å‘å¸ƒæ–°html
  gulp.watch([&#39;!**/gulpfile.js&#39;, &#39;src/**/*.html&#39;], () =&gt; {
    runSequence(
      &#39;del:html&#39;,
       &#39;dist:html&#39;,
      &#39;reload:browser&#39;
    );
  });
  cb();
});

// å‘å¸ƒæ¨¡å¼
// buildä»»åŠ¡ï¼Œè¿›è¡Œé¡¹ç›®èµ„æºå‘å¸ƒ
gulp.task(&#39;build&#39;, cb =&gt; {
  runSequence(
    [&#39;del:html&#39;, &#39;del:js&#39;],
    &#39;dist:html&#39;,
    &#39;dist:js&#39;,
    cb
  );
});

// å¼€å‘æ¨¡å¼
// æ‰§è¡Œå‘å¸ƒï¼Œå¹¶è¿›è¡Œç›‘å¬
gulp.task(&#39;default&#39;, cb =&gt; {
  runSequence(
    &#39;build&#39;,
    &#39;start:browserSync&#39;,
    [&#39;watch:js&#39;, &#39;watch:html&#39;, &#39;watch:css&#39;],
    cb
  );
});
</code></pre>

<p>å½“ç„¶ï¼Œå¸¸ç”¨çš„è¿˜æœ‰å‘å¸ƒä»»åŠ¡</p>

<pre><code class="language-javascript">// å‘å¸ƒæ¨¡å¼
// æ„å»ºèµ„æºå‘å¸ƒï¼Œå¹¶é€€å‡ºgulpè¿›ç¨‹
gulp.task(&#39;dist&#39;, cb =&gt; {
  gutil.env.env = gutil.env.env === undefined ? &#39;production&#39; : gutil.env.env;
  runSequence(
    &#39;build&#39;,
    () =&gt; {
      cb();
      process.nextTick(process.exit);
    }
  );
});
</code></pre>

<h2 id="toc_20">æ€»ç»“</h2>

<p>æ–‡ç« é‡Œä¸»è¦æ•´ç†äº†æˆ‘åœ¨é¡¹ç›®ä¸­ç”¨åˆ°çš„ä¸€äº›è§£å†³æ–¹æ¡ˆä¸å®è·µæ–¹æ³•ã€‚å…¶ä¸­ä¹Ÿè¿˜å­˜åœ¨ä¸€äº›ä¸è¶³ï¼Œä¾‹å¦‚HTMLä¸CSSçš„å¢é‡å‘å¸ƒç­‰ï¼Œè¿™äº›éƒ½æ˜¯ä¹‹åå¯ä»¥å†è¿›è¡Œä¼˜åŒ–çš„åœ°æ–¹ã€‚</p>

<p>å®Œã€‚</p>

<hr/>

<h2 id="toc_21">Happy Codingï¼</h2>

<hr/>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15236400113573.html"  title="Previous Post: ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹">&laquo; ã€MongoDBé«˜å¯ç”¨ã€‘å¤åˆ¶é›†Replica Setä½¿ç”¨ç®€ä»‹</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15236404711802.html" 
	        title="Next Post: æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€»">æµè§ˆå™¨åŒæºç­–ç•¥ä¸ajaxè·¨åŸŸæ–¹æ³•æ±‡æ€» &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15236401468681.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
